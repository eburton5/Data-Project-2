try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['osfruntime.js'] = (new Date()).getTime();
/* Office runtime JavaScript library */
/* Version: 16.0.3811.1000 */
/*
	Copyright (c) Microsoft Corporation.  All rights reserved.
*/

/*
	Your use of this file is governed by the Microsoft Services Agreement http://go.microsoft.com/fwlink/?LinkId=266419.
*/

var __extends=this.__extends||function(b,a){for(var c in a)if(a.hasOwnProperty(c))b[c]=a[c];function d(){this.constructor=b}d.prototype=a.prototype;b.prototype=new d},OSF=OSF||{},Agave;(function(a){(function(b){var a=function(){function a(a){this._internalStorage=a}a.prototype.getItem=function(a){try{return this._internalStorage&&this._internalStorage.getItem(a)}catch(b){return null}};a.prototype.setItem=function(b,a){try{this._internalStorage&&this._internalStorage.setItem(b,a)}catch(c){}};a.prototype.clear=function(){try{this._internalStorage&&this._internalStorage.clear()}catch(a){}};a.prototype.removeItem=function(a){try{this._internalStorage&&this._internalStorage.removeItem(a)}catch(b){}};a.prototype.getKeysWithPrefix=function(d){var b=[];try{for(var e=this._internalStorage&&this._internalStorage.length||0,a=0;a<e;a++){var c=this._internalStorage.key(a);c.indexOf(d)===0&&b.push(c)}}catch(f){}return b};return a}();b.SafeStorage=a})(a.Utils||(a.Utils={}));var b=a.Utils})(Agave||(Agave={}));OSF.OUtil=function(){var f="on",j="configurable",i="writable",e="enumerable",d="undefined",c=true,a=false,g=2147483647,b=null,o=-1,r="&_xdm_Info=",p="_xdm_",l="#",n={},t=3e4,k=b,m=b,h=(new Date).getTime();function s(){var a=g*Math.random();a^=h^(new Date).getMilliseconds()<<Math.floor(Math.random()*(31-10));return a.toString(16)}function q(){if(!k){try{var a=window.sessionStorage}catch(c){a=b}k=new Agave.Utils.SafeStorage(a)}return k}return {set_entropy:function(a){if(typeof a=="string")for(var b=0;b<a.length;b+=4){for(var d=0,c=0;c<4&&b+c<a.length;c++)d=(d<<8)+a.charCodeAt(b+c);h^=d}else if(typeof a=="number")h^=a;else h^=g*Math.random();h&=g},extend:function(b,a){var c=function(){};c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b;b.uber=a.prototype;if(a.prototype.constructor===Object.prototype.constructor)a.prototype.constructor=a},setNamespace:function(b,a){if(a&&b&&!a[b])a[b]={}},unsetNamespace:function(b,a){if(a&&b&&a[b])delete a[b]},loadScript:function(f,g,h){if(f&&g){var k=window.document,d=n[f];if(!d){var e=k.createElement("script");e.type="text/javascript";d={loaded:a,pendingCallbacks:[g],timer:b};n[f]=d;var i=function(){if(d.timer!=b){clearTimeout(d.timer);delete d.timer}d.loaded=c;for(var e=d.pendingCallbacks.length,a=0;a<e;a++){var f=d.pendingCallbacks.shift();f()}},j=function(){delete n[f];if(d.timer!=b){clearTimeout(d.timer);delete d.timer}for(var c=d.pendingCallbacks.length,a=0;a<c;a++){var e=d.pendingCallbacks.shift();e()}};if(e.readyState)e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){e.onreadystatechange=b;i()}};else e.onload=i;e.onerror=j;h=h||t;d.timer=setTimeout(j,h);e.src=f;k.getElementsByTagName("head")[0].appendChild(e)}else if(d.loaded)g();else d.pendingCallbacks.push(g)}},loadCSS:function(c){if(c){var b=window.document,a=b.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=c;b.getElementsByTagName("head")[0].appendChild(a)}},parseEnum:function(b,c){var a=c[b.trim()];if(typeof a==d){Sys.Debug.trace("invalid enumeration string:"+b);throw Error.argument("str")}return a},delayExecutionAndCache:function(){var a={calc:arguments[0]};return function(){if(a.calc){a.val=a.calc.apply(this,arguments);delete a.calc}return a.val}},getUniqueId:function(){o=o+1;return o.toString()},formatString:function(){var a=arguments,b=a[0];return b.replace(/{(\d+)}/gm,function(d,b){var c=parseInt(b,10)+1;return a[c]===undefined?"{"+b+"}":a[c]})},generateConversationId:function(){return [s(),s(),(new Date).getTime().toString()].join("_")},getFrameNameAndConversationId:function(b,c){var a=p+b+this.generateConversationId();c.setAttribute("name",a);return this.generateConversationId()},addXdmInfoAsHash:function(a,d){a=a.trim()||"";var b=a.split(l),c=b.shift(),e=b.join(l);return [c,l,e,r,d].join("")},parseXdmInfo:function(a){return OSF.OUtil.parseXdmInfoWithGivenFragment(a,window.location.hash)},parseXdmInfoWithGivenFragment:function(h,i){var e=i.split(r),a=e.length>1?e[e.length-1]:b,c=q();if(!h&&c){var d=window.name.indexOf(p);if(d>-1){var f=window.name.indexOf(";",d);if(f==-1)f=window.name.length;var g=window.name.substring(d,f);if(a)c.setItem(g,a);else a=c.getItem(g)}}return a},getConversationId:function(){var c=window.location.search,a=b;if(c){var d=c.indexOf("&");a=d>0?c.substring(1,d):c.substr(1);if(a&&a.charAt(a.length-1)==="="){a=a.substring(0,a.length-1);if(a)a=decodeURIComponent(a)}}return a},getInfoItems:function(b){var a=b.split("$");if(typeof a[1]==d)a=b.split("|");return a},getConversationUrl:function(){var b="",d=OSF.OUtil.parseXdmInfo(c);if(d){var a=OSF.OUtil.getInfoItems(d);if(a!=undefined&&a.length>=3)b=a[2]}return b},validateParamObject:function(f,e){var b=Function._validateParams(arguments,[{name:"params",type:Object,mayBeNull:a},{name:"expectedProperties",type:Object,mayBeNull:a},{name:"callback",type:Function,mayBeNull:c}]);if(b)throw b;for(var d in e){b=Function._validateParameter(f[d],e[d],d);if(b)throw b}},writeProfilerMark:function(a){if(window.msWriteProfilerMark){window.msWriteProfilerMark(a);typeof Sys!==d&&Sys&&Sys.Debug&&Sys.Debug.trace(a)}},outputDebug:function(a){typeof Sys!==d&&Sys&&Sys.Debug&&Sys.Debug.trace(a)},defineNondefaultProperty:function(e,f,a,b){a=a||{};for(var g in b){var d=b[g];if(a[d]==undefined)a[d]=c}Object.defineProperty(e,f,a);return e},defineNondefaultProperties:function(c,a,d){a=a||{};for(var b in a)OSF.OUtil.defineNondefaultProperty(c,b,a[b],d);return c},defineEnumerableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[e])},defineEnumerableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[e])},defineMutableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[i,e,j])},defineMutableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[i,e,j])},finalizeProperties:function(e,d){d=d||{};for(var g=Object.getOwnPropertyNames(e),i=g.length,f=0;f<i;f++){var h=g[f],b=Object.getOwnPropertyDescriptor(e,h);if(!b.get&&!b.set)b.writable=d.writable||a;b.configurable=d.configurable||a;b.enumerable=d.enumerable||c;Object.defineProperty(e,h,b)}return e},mapList:function(a,c){var b=[];if(a)for(var d in a)b.push(c(a[d]));return b},listContainsKey:function(d,e){for(var b in d)if(e==b)return c;return a},listContainsValue:function(b,d){for(var e in b)if(d==b[e])return c;return a},augmentList:function(a,b){var d=a.push?function(c,b){a.push(b)}:function(c,b){a[c]=b};for(var c in b)d(c,b[c])},redefineList:function(a,b){for(var d in a)delete a[d];for(var c in b)a[c]=b[c]},isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},isFunction:function(a){return Object.prototype.toString.apply(a)==="[object Function]"},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},addEventListener:function(b,c,d){if(b.addEventListener)b.addEventListener(c,d,a);else if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&b.attachEvent)b.attachEvent(f+c,d);else b[f+c]=d},removeEventListener:function(c,d,e){if(c.removeEventListener)c.removeEventListener(d,e,a);else if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&c.detachEvent)c.detachEvent(f+d,e);else c[f+d]=b},encodeBase64:function(c){if(!c)return c;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=[],b=[],h=0,j,g,i,d,e,f,a,m=c.length;do{j=c.charCodeAt(h++);g=c.charCodeAt(h++);i=c.charCodeAt(h++);a=0;d=j&255;e=j>>8;f=g&255;b[a++]=d>>2;b[a++]=(d&3)<<4|e>>4;b[a++]=(e&15)<<2|f>>6;b[a++]=f&63;if(!isNaN(g)){d=g>>8;e=i&255;f=i>>8;b[a++]=d>>2;b[a++]=(d&3)<<4|e>>4;b[a++]=(e&15)<<2|f>>6;b[a++]=f&63}if(isNaN(g))b[a-1]=64;else if(isNaN(i)){b[a-2]=64;b[a-1]=64}for(var k=0;k<a;k++)l.push(n.charAt(b[k]))}while(h<m);return l.join("")},getSessionStorage:function(){return q()},getLocalStorage:function(){if(!m){try{var a=window.localStorage}catch(c){a=b}m=new Agave.Utils.SafeStorage(a)}return m},convertIntToCssHexColor:function(b){var a="#"+(Number(b)+16777216).toString(16).slice(-6);return a},attachClickHandler:function(a,b){a.onclick=function(){b()};a.ontouchend=function(a){b();a.preventDefault()}},getQueryStringParamValue:function(b,d){var e=Function._validateParams(arguments,[{name:"queryString",type:String,mayBeNull:a},{name:"paramName",type:String,mayBeNull:a}]);if(e){Sys.Debug.trace("OSF_Outil_getQueryStringParamValue: Parameters cannot be null.");return ""}var c=new RegExp("[\\?&]"+d+"=([^&#]*)","i");if(!c.test(b)){Sys.Debug.trace("OSF_Outil_getQueryStringParamValue: The parameter is not found.");return ""}return c.exec(b)[1]},isiOS:function(){return window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?c:a},shallowCopy:function(a){var c=a.constructor();for(var b in a)if(a.hasOwnProperty(b))c[b]=a[b];return c}}}();OSF.OUtil.Guid=function(){var a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return {generateNewGuid:function(){for(var c="",d=(new Date).getTime(),b=0;b<32&&d>0;b++){if(b==8||b==12||b==16||b==20)c+="-";c+=a[d%16];d=Math.floor(d/16)}for(;b<32;b++){if(b==8||b==12||b==16||b==20)c+="-";c+=a[Math.floor(Math.random()*16)]}return c}}}();window.OSF=OSF;OSF.OUtil.setNamespace("Microsoft",window);OSF.OUtil.setNamespace("Office",Microsoft);OSF.OUtil.setNamespace("Common",Microsoft.Office);(function(a){"use strict";var j=new RegExp('"(\\\\.|[^"\\\\])*"',"g"),d=new RegExp("\\b(true|false|null)\\b","g"),h=new RegExp("-?(0|([1-9]\\d*))(\\.\\d+)?([eE][+-]?\\d+)?","g"),g=new RegExp("[^{:,\\[\\s](?=\\s*\\[)"),e=new RegExp("[^\\s\\[\\]{}:,]"),b="Cannot deserialize. The data does not correspond to valid JSON.";function k(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else a.attachEvent&&a.attachEvent("on"+b,c)}function f(){var a="undefined";if(typeof Sys!==a&&typeof Sys.Serialization!==a&&typeof Sys.Serialization.JavaScriptSerializer!==a)return Sys.Serialization.JavaScriptSerializer;return null}function i(f,k,i){var c;if(!k)return i(f);if(a.JSON&&a.JSON.parse)return a.JSON.parse(f);c=f.replace(j,"[]");c=c.replace(d,"[]");c=c.replace(h,"[]");if(g.test(c))throw b;if(e.test(c))throw b;try{eval("("+f+")")}catch(l){throw b}}function c(){var a=f(),b;if(a===null||typeof a.deserialize!=="function")return false;if(a.__patchVersion>=1)return true;b=a.deserialize;a.deserialize=function(a){return i(a,true,b)};a.__patchVersion=1;return true}!c()&&k(a,"load",function(){c()})})(window);Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5};Microsoft.Office.Common.InvokeResultCode={noError:0,errorInRequest:-1,errorHandlingRequest:-2,errorInResponse:-3,errorHandlingResponse:-4,errorHandlingRequestAccessDenied:-5,errorHandlingMethodCallTimedout:-6};Microsoft.Office.Common.MessageType={request:0,response:1};Microsoft.Office.Common.ActionType={invoke:0,registerEvent:1,unregisterEvent:2};Microsoft.Office.Common.ResponseType={forCalling:0,forEventing:1};Microsoft.Office.Common.MethodObject=function(c,b,a){this._method=c;this._invokeType=b;this._blockingOthers=a};Microsoft.Office.Common.MethodObject.prototype={getMethod:function(){return this._method},getInvokeType:function(){return this._invokeType},getBlockingFlag:function(){return this._blockingOthers}};Microsoft.Office.Common.EventMethodObject=function(b,a){this._registerMethodObject=b;this._unregisterMethodObject=a};Microsoft.Office.Common.EventMethodObject.prototype={getRegisterMethodObject:function(){return this._registerMethodObject},getUnregisterMethodObject:function(){return this._unregisterMethodObject}};Microsoft.Office.Common.ServiceEndPoint=function(c){var a=this,b=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:false}]);if(b)throw b;a._methodObjectList={};a._eventHandlerProxyList={};a._Id=c;a._conversations={};a._policyManager=null};Microsoft.Office.Common.ServiceEndPoint.prototype={registerMethod:function(g,h,b,e){var c="invokeType",a=false,d=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:a},{name:"method",type:Function,mayBeNull:a},{name:c,type:Number,mayBeNull:a},{name:"blockingOthers",type:Boolean,mayBeNull:a}]);if(d)throw d;if(b!==Microsoft.Office.Common.InvokeType.async&&b!==Microsoft.Office.Common.InvokeType.sync)throw Error.argument(c);var f=new Microsoft.Office.Common.MethodObject(h,b,e);this._methodObjectList[g]=f},unregisterMethod:function(b){var a=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:false}]);if(a)throw a;delete this._methodObjectList[b]},registerEvent:function(f,d,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a}]);if(b)throw b;var e=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(d,Microsoft.Office.Common.InvokeType.syncRegisterEvent,a),new Microsoft.Office.Common.MethodObject(c,Microsoft.Office.Common.InvokeType.syncUnregisterEvent,a));this._methodObjectList[f]=e},registerEventEx:function(h,f,d,e,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"registerMethodInvokeType",type:Number,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a},{name:"unregisterMethodInvokeType",type:Number,mayBeNull:a}]);if(b)throw b;var g=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(f,d,a),new Microsoft.Office.Common.MethodObject(e,c,a));this._methodObjectList[h]=g},unregisterEvent:function(b){var a=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:false}]);if(a)throw a;this.unregisterMethod(b)},registerConversation:function(b,a){var c=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false},{name:"conversationUrl",type:String,mayBeNull:false,optional:true}]);if(c)throw c;if(a)this._conversations[b]=a;else this._conversations[b]=true},unregisterConversation:function(b){var a=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false}]);if(a)throw a;delete this._conversations[b]},setPolicyManager:function(a){var b="policyManager",c=Function._validateParams(arguments,[{name:b,type:Object,mayBeNull:false}]);if(c)throw c;if(!a.checkPermission)throw Error.argument(b);this._policyManager=a},getPolicyManager:function(){return this._policyManager}};Microsoft.Office.Common.ClientEndPoint=function(e,b,f){var c="targetWindow",a=this,d=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false},{name:c,mayBeNull:false},{name:"targetUrl",type:String,mayBeNull:false}]);if(d)throw d;if(!b.postMessage)throw Error.argument(c);a._conversationId=e;a._targetWindow=b;a._targetUrl=f;a._callingIndex=0;a._callbackList={};a._eventHandlerList={}};Microsoft.Office.Common.ClientEndPoint.prototype={invoke:function(h,d,b){var a=this,g=Function._validateParams(arguments,[{name:"targetMethodName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"param",mayBeNull:true}]);if(g)throw g;var c=a._callingIndex++,k=new Date,e={callback:d,createdOn:k.getTime()};if(b&&typeof b==="object"&&typeof b.__timeout__==="number"){e.timeout=b.__timeout__;delete b.__timeout__}a._callbackList[c]=e;try{var i=new Microsoft.Office.Common.Request(h,Microsoft.Office.Common.ActionType.invoke,a._conversationId,c,b),j=Microsoft.Office.Common.MessagePackager.envelope(i);a._targetWindow.postMessage(j,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(f){try{d!==null&&d(Microsoft.Office.Common.InvokeResultCode.errorInRequest,f)}finally{delete a._callbackList[c]}}},registerForEvent:function(d,g,c,i){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"eventHandler",type:Function,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,k=new Date;a._callbackList[b]={callback:c,createdOn:k.getTime()};try{var h=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.registerEvent,a._conversationId,b,i),j=Microsoft.Office.Common.MessagePackager.envelope(h);a._targetWindow.postMessage(j,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer();a._eventHandlerList[d]=g}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}},unregisterForEvent:function(d,c,h){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,j=new Date;a._callbackList[b]={callback:c,createdOn:j.getTime()};try{var g=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.unregisterEvent,a._conversationId,b,h),i=Microsoft.Office.Common.MessagePackager.envelope(g);a._targetWindow.postMessage(i,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}finally{delete a._eventHandlerList[d]}}};Microsoft.Office.Common.XdmCommunicationManager=function(){var i="channel is not ready.",c="conversationId",h="Unknown conversation Id.",b=false,a=null,k=[],e=a,x=10,j=b,f=a,q=2e3,l=65000,m=l,g={},d={},o=b;function r(b){for(var a in g)if(g[a]._conversations[b])return g[a];Sys.Debug.trace(h);throw Error.argument(c)}function s(b){var a=d[b];if(!a){Sys.Debug.trace(h);throw Error.argument(c)}return a}function v(e,c){var b=e._methodObjectList[c._actionName];if(!b){Sys.Debug.trace("The specified method is not registered on service endpoint:"+c._actionName);throw Error.argument("messageObject")}var d=a;if(c._actionType===Microsoft.Office.Common.ActionType.invoke)d=b;else if(c._actionType===Microsoft.Office.Common.ActionType.registerEvent)d=b.getRegisterMethodObject();else d=b.getUnregisterMethodObject();return d}function z(a){k.push(a)}function y(){if(e!==a){if(!j)if(k.length>0){var b=k.shift();j=b.getInvokeBlockingFlag();b.invoke()}else{clearInterval(e);e=a}}else Sys.Debug.trace(i)}function u(){if(f){var c,g=0,k=new Date,e;for(var j in d){c=d[j];for(var h in c._callbackList){var b=c._callbackList[h];e=b.timeout?b.timeout:m;if(e>=0&&Math.abs(k.getTime()-b.createdOn)>=e)try{b.callback&&b.callback(Microsoft.Office.Common.InvokeResultCode.errorHandlingMethodCallTimedout,a)}finally{delete c._callbackList[h]}else g++}}if(g===0){clearInterval(f);f=a}}else Sys.Debug.trace(i)}function t(){j=b}function w(a){if(window.addEventListener)window.addEventListener("message",a,b);else if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&window.attachEvent)window.attachEvent("onmessage",a);else{Sys.Debug.trace("Browser doesn't support the required API.");throw Error.argument("Browser")}}function n(d,e){var f=b;if(d===true)return true;if(!d||!e||!d.length||!e.length)return f;var c,a;c=document.createElement("a");a=document.createElement("a");c.href=d;a.href=e;f=c.hostname==a.hostname&&c.protocol==a.protocol&&c.port==a.port;delete c,a;return f}function A(c){var g="Access Denied";if(c.data!=""){var b;try{b=Microsoft.Office.Common.MessagePackager.unenvelope(c.data)}catch(h){return}if(typeof b._messageType=="undefined")return;if(b._messageType===Microsoft.Office.Common.MessageType.request){var l=c.origin==a||c.origin=="null"?b._origin:c.origin;try{var d=r(b._conversationId);var k=d.getPolicyManager();if(k&&!k.checkPermission(b._conversationId,b._actionName,b._data))throw g;var u=v(d,b),o=new Microsoft.Office.Common.InvokeCompleteCallback(c.source,l,b._actionName,b._conversationId,b._correlationId,t),w=new Microsoft.Office.Common.Invoker(u,b._data,o,d._eventHandlerProxyList,b._conversationId,b._actionName);if(e==a)e=setInterval(y,x);z(w)}catch(h){var m=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequest;if(h==g)m=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequestAccessDenied;var q=new Microsoft.Office.Common.Response(b._actionName,b._conversationId,b._correlationId,m,Microsoft.Office.Common.ResponseType.forCalling,h),p=Microsoft.Office.Common.MessagePackager.envelope(q);c.source&&c.source.postMessage&&c.source.postMessage(p,l)}}else if(b._messageType===Microsoft.Office.Common.MessageType.response){var f=s(b._conversationId);if(!n(f._targetUrl,c.origin))throw"Failed orgin check";if(b._responseType===Microsoft.Office.Common.ResponseType.forCalling){var i=f._callbackList[b._correlationId];if(i)try{i.callback&&i.callback(b._errorCode,b._data)}finally{delete f._callbackList[b._correlationId]}}else{var j=f._eventHandlerList[b._actionName];j!==undefined&&j!==a&&j(b._data)}}else return}}function p(){if(!o){w(A);o=true}}return {connect:function(b,c,e){var a=d[b];if(!a){p();a=new Microsoft.Office.Common.ClientEndPoint(b,c,e);d[b]=a}return a},getClientEndPoint:function(e){var a=Function._validateParams(arguments,[{name:c,type:String,mayBeNull:b}]);if(a)throw a;return d[e]},createServiceEndPoint:function(a){p();var b=new Microsoft.Office.Common.ServiceEndPoint(a);g[a]=b;return b},getServiceEndPoint:function(c){var a=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:b}]);if(a)throw a;return g[c]},deleteClientEndPoint:function(e){var a=Function._validateParams(arguments,[{name:c,type:String,mayBeNull:b}]);if(a)throw a;delete d[e]},_setMethodTimeout:function(a){var c=Function._validateParams(arguments,[{name:"methodTimeout",type:Number,mayBeNull:b}]);if(c)throw c;m=a<=0?l:a},_startMethodTimeoutTimer:function(){if(!f)f=setInterval(u,q)}}}();Microsoft.Office.Common.Message=function(g,h,e,f,c){var b=false,a=this,d=Function._validateParams(arguments,[{name:"messageType",type:Number,mayBeNull:b},{name:"actionName",type:String,mayBeNull:b},{name:"conversationId",type:String,mayBeNull:b},{name:"correlationId",mayBeNull:b},{name:"data",mayBeNull:true,optional:true}]);if(d)throw d;a._messageType=g;a._actionName=h;a._conversationId=e;a._correlationId=f;a._origin=window.location.href;if(typeof c=="undefined")a._data=null;else a._data=c};Microsoft.Office.Common.Message.prototype={getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getOrigin:function(){return this._origin},getData:function(){return this._data},getMessageType:function(){return this._messageType}};Microsoft.Office.Common.Request=function(c,d,a,b,e){Microsoft.Office.Common.Request.uber.constructor.call(this,Microsoft.Office.Common.MessageType.request,c,a,b,e);this._actionType=d};OSF.OUtil.extend(Microsoft.Office.Common.Request,Microsoft.Office.Common.Message);Microsoft.Office.Common.Request.prototype.getActionType=function(){return this._actionType};Microsoft.Office.Common.Response=function(d,a,b,e,c,f){Microsoft.Office.Common.Response.uber.constructor.call(this,Microsoft.Office.Common.MessageType.response,d,a,b,f);this._errorCode=e;this._responseType=c};OSF.OUtil.extend(Microsoft.Office.Common.Response,Microsoft.Office.Common.Message);Microsoft.Office.Common.Response.prototype.getErrorCode=function(){return this._errorCode};Microsoft.Office.Common.Response.prototype.getResponseType=function(){return this._responseType};Microsoft.Office.Common.MessagePackager={envelope:function(a){return Sys.Serialization.JavaScriptSerializer.serialize(a)},unenvelope:function(a){return Sys.Serialization.JavaScriptSerializer.deserialize(a,true)}};Microsoft.Office.Common.ResponseSender=function(e,h,j,f,g,i){var c=false,a=this,d=Function._validateParams(arguments,[{name:"requesterWindow",mayBeNull:c},{name:"requesterUrl",type:String,mayBeNull:c},{name:"actionName",type:String,mayBeNull:c},{name:"conversationId",type:String,mayBeNull:c},{name:"correlationId",mayBeNull:c},{name:"responsetype",type:Number,maybeNull:c}]);if(d)throw d;a._requesterWindow=e;a._requesterUrl=h;a._actionName=j;a._conversationId=f;a._correlationId=g;a._invokeResultCode=Microsoft.Office.Common.InvokeResultCode.noError;a._responseType=i;var b=a;a._send=function(e){try{var d=new Microsoft.Office.Common.Response(b._actionName,b._conversationId,b._correlationId,b._invokeResultCode,b._responseType,e),c=Microsoft.Office.Common.MessagePackager.envelope(d);b._requesterWindow.postMessage(c,b._requesterUrl)}catch(a){Sys.Debug.trace("ResponseSender._send error:"+a.message)}}};Microsoft.Office.Common.ResponseSender.prototype={getRequesterWindow:function(){return this._requesterWindow},getRequesterUrl:function(){return this._requesterUrl},getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getSend:function(){return this._send},setResultCode:function(a){this._invokeResultCode=a}};Microsoft.Office.Common.InvokeCompleteCallback=function(d,g,h,e,f,c){var b=this;Microsoft.Office.Common.InvokeCompleteCallback.uber.constructor.call(b,d,g,h,e,f,Microsoft.Office.Common.ResponseType.forCalling);b._postCallbackHandler=c;var a=b;b._send=function(e){try{var d=new Microsoft.Office.Common.Response(a._actionName,a._conversationId,a._correlationId,a._invokeResultCode,a._responseType,e),c=Microsoft.Office.Common.MessagePackager.envelope(d);a._requesterWindow.postMessage(c,a._requesterUrl);a._postCallbackHandler()}catch(b){Sys.Debug.trace("InvokeCompleteCallback._send error:"+b.message)}}};OSF.OUtil.extend(Microsoft.Office.Common.InvokeCompleteCallback,Microsoft.Office.Common.ResponseSender);Microsoft.Office.Common.Invoker=function(g,h,d,e,f,i){var b=false,a=this,c=Function._validateParams(arguments,[{name:"methodObject",mayBeNull:b},{name:"paramValue",mayBeNull:true},{name:"invokeCompleteCallback",mayBeNull:b},{name:"eventHandlerProxyList",mayBeNull:true},{name:"conversationId",type:String,mayBeNull:b},{name:"eventName",type:String,mayBeNull:b}]);if(c)throw c;a._methodObject=g;a._param=h;a._invokeCompleteCallback=d;a._eventHandlerProxyList=e;a._conversationId=f;a._eventName=i};Microsoft.Office.Common.Invoker.prototype={invoke:function(){var a=this;try{var b;switch(a._methodObject.getInvokeType()){case Microsoft.Office.Common.InvokeType.async:a._methodObject.getMethod()(a._param,a._invokeCompleteCallback.getSend());break;case Microsoft.Office.Common.InvokeType.sync:b=a._methodObject.getMethod()(a._param);a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncRegisterEvent:var d=a._createEventHandlerProxyObject(a._invokeCompleteCallback);b=a._methodObject.getMethod()(d.getSend(),a._param);a._eventHandlerProxyList[a._conversationId+a._eventName]=d.getSend();a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncUnregisterEvent:var g=a._eventHandlerProxyList[a._conversationId+a._eventName];b=a._methodObject.getMethod()(g,a._param);delete a._eventHandlerProxyList[a._conversationId+a._eventName];a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.asyncRegisterEvent:var c=a._createEventHandlerProxyObject(a._invokeCompleteCallback);a._methodObject.getMethod()(c.getSend(),a._invokeCompleteCallback.getSend(),a._param);a._eventHandlerProxyList[a._callerId+a._eventName]=c.getSend();break;case Microsoft.Office.Common.InvokeType.asyncUnregisterEvent:var f=a._eventHandlerProxyList[a._callerId+a._eventName];a._methodObject.getMethod()(f,a._invokeCompleteCallback.getSend(),a._param);delete a._eventHandlerProxyList[a._callerId+a._eventName]}}catch(e){a._invokeCompleteCallback.setResultCode(Microsoft.Office.Common.InvokeResultCode.errorInResponse);a._invokeCompleteCallback.getSend()(e)}},getInvokeBlockingFlag:function(){return this._methodObject.getBlockingFlag()},_createEventHandlerProxyObject:function(a){return new Microsoft.Office.Common.ResponseSender(a.getRequesterWindow(),a.getRequesterUrl(),a.getActionName(),a.getConversationId(),a.getCorrelationId(),Microsoft.Office.Common.ResponseType.forEventing)}};OSF.OUtil.setNamespace("OSF",window);OSF.InternalPerfMarker={DataCoercionBegin:"Agave.HostCall.CoerceDataStart",DataCoercionEnd:"Agave.HostCall.CoerceDataEnd"};OSF.HostCallPerfMarker={IssueCall:"Agave.HostCall.IssueCall",ReceiveResponse:"Agave.HostCall.ReceiveResponse",RuntimeExceptionRaised:"Agave.HostCall.RuntimeExecptionRaised"};OSF.AgaveHostAction={Select:0,UnSelect:1,CancelDialog:2,InsertAgave:3,CtrlF6In:4,CtrlF6Exit:5,CtrlF6ExitShift:6,SelectWithError:7};OSF.SharedConstants={NotificationConversationIdSuffix:"_ntf"};OSF.OfficeAppContext=function(n,j,f,e,h,k,g,i,m,b,l,d,c){var a=this;a._id=n;a._appName=j;a._appVersion=f;a._appUILocale=e;a._dataLocale=h;a._docUrl=k;a._clientMode=g;a._settings=i;a._reason=m;a._osfControlType=b;a._eToken=l;a._correlationId=d;a._appInstanceId=c;a.get_id=function(){return this._id};a.get_appName=function(){return this._appName};a.get_appVersion=function(){return this._appVersion};a.get_appUILocale=function(){return this._appUILocale};a.get_dataLocale=function(){return this._dataLocale};a.get_docUrl=function(){return this._docUrl};a.get_clientMode=function(){return this._clientMode};a.get_bindings=function(){return this._bindings};a.get_settings=function(){return this._settings};a.get_reason=function(){return this._reason};a.get_osfControlType=function(){return this._osfControlType};a.get_eToken=function(){return this._eToken};a.get_correlationId=function(){return this._correlationId};a.get_appInstanceId=function(){return this._appInstanceId}};OSF.AppName={Unsupported:0,Excel:1,Word:2,PowerPoint:4,Outlook:8,ExcelWebApp:16,WordWebApp:32,OutlookWebApp:64,Project:128,AccessWebApp:256,PowerpointWebApp:512,ExcelIOS:1024,Sway:2048};OSF.OsfControlType={DocumentLevel:0,ContainerLevel:1};OSF.ClientMode={ReadOnly:0,ReadWrite:1};OSF.OUtil.setNamespace("Microsoft",window);OSF.OUtil.setNamespace("Office",Microsoft);OSF.OUtil.setNamespace("Client",Microsoft.Office);OSF.OUtil.setNamespace("WebExtension",Microsoft.Office);Microsoft.Office.WebExtension.InitializationReason={Inserted:"inserted",DocumentOpened:"documentOpened"};Microsoft.Office.WebExtension.ValueFormat={Unformatted:"unformatted",Formatted:"formatted"};Microsoft.Office.WebExtension.FilterType={All:"all"};Microsoft.Office.WebExtension.Parameters={BindingType:"bindingType",CoercionType:"coercionType",ValueFormat:"valueFormat",FilterType:"filterType",Columns:"columns",SampleData:"sampleData",GoToType:"goToType",SelectionMode:"selectionMode",Id:"id",PromptText:"promptText",ItemName:"itemName",FailOnCollision:"failOnCollision",StartRow:"startRow",StartColumn:"startColumn",RowCount:"rowCount",ColumnCount:"columnCount",Callback:"callback",AsyncContext:"asyncContext",Data:"data",Rows:"rows",OverwriteIfStale:"overwriteIfStale",FileType:"fileType",EventType:"eventType",Handler:"handler",SliceSize:"sliceSize",SliceIndex:"sliceIndex",ActiveView:"activeView",Xml:"xml",Namespace:"namespace",Prefix:"prefix",XPath:"xPath",TaskId:"taskId",FieldId:"fieldId",FieldValue:"fieldValue",ServerUrl:"serverUrl",ListName:"listName",ResourceId:"resourceId",ViewType:"viewType",ViewName:"viewName",GetRawValue:"getRawValue",CellFormat:"cellFormat",TableOptions:"tableOptions",TaskIndex:"taskIndex",ResourceIndex:"resourceIndex"};OSF.OUtil.setNamespace("DDA",OSF);OSF.DDA.DocumentMode={ReadOnly:1,ReadWrite:0};OSF.DDA.PropertyDescriptors={AsyncResultStatus:"AsyncResultStatus"};OSF.DDA.EventDescriptors={};OSF.DDA.ListDescriptors={};OSF.DDA.getXdmEventName=function(b,a){if(a==Microsoft.Office.WebExtension.EventType.BindingSelectionChanged||a==Microsoft.Office.WebExtension.EventType.BindingDataChanged)return b+"_"+a;else return a};OSF.DDA.MethodDispId={dispidMethodMin:64,dispidGetSelectedDataMethod:64,dispidSetSelectedDataMethod:65,dispidAddBindingFromSelectionMethod:66,dispidAddBindingFromPromptMethod:67,dispidGetBindingMethod:68,dispidReleaseBindingMethod:69,dispidGetBindingDataMethod:70,dispidSetBindingDataMethod:71,dispidAddRowsMethod:72,dispidClearAllRowsMethod:73,dispidGetAllBindingsMethod:74,dispidLoadSettingsMethod:75,dispidSaveSettingsMethod:76,dispidGetDocumentCopyMethod:77,dispidAddBindingFromNamedItemMethod:78,dispidAddColumnsMethod:79,dispidGetDocumentCopyChunkMethod:80,dispidReleaseDocumentCopyMethod:81,dispidNavigateToMethod:82,dispidGetActiveViewMethod:83,dispidGetDocumentThemeMethod:84,dispidGetOfficeThemeMethod:85,dispidGetFilePropertiesMethod:86,dispidClearFormatsMethod:87,dispidSetTableOptionsMethod:88,dispidSetFormatsMethod:89,dispidAddDataPartMethod:128,dispidGetDataPartByIdMethod:129,dispidGetDataPartsByNamespaceMethod:130,dispidGetDataPartXmlMethod:131,dispidGetDataPartNodesMethod:132,dispidDeleteDataPartMethod:133,dispidGetDataNodeValueMethod:134,dispidGetDataNodeXmlMethod:135,dispidGetDataNodesMethod:136,dispidSetDataNodeValueMethod:137,dispidSetDataNodeXmlMethod:138,dispidAddDataNamespaceMethod:139,dispidGetDataUriByPrefixMethod:140,dispidGetDataPrefixByUriMethod:141,dispidMethodMax:141,dispidGetSelectedTaskMethod:110,dispidGetSelectedResourceMethod:111,dispidGetTaskMethod:112,dispidGetResourceFieldMethod:113,dispidGetWSSUrlMethod:114,dispidGetTaskFieldMethod:115,dispidGetProjectFieldMethod:116,dispidGetSelectedViewMethod:117,dispidGetTaskByIndexMethod:118,dispidGetResourceByIndexMethod:119,dispidSetTaskFieldMethod:120,dispidSetResourceFieldMethod:121,dispidGetMaxTaskIndexMethod:122,dispidGetMaxResourceIndexMethod:123};OSF.DDA.EventDispId={dispidEventMin:0,dispidInitializeEvent:0,dispidSettingsChangedEvent:1,dispidDocumentSelectionChangedEvent:2,dispidBindingSelectionChangedEvent:3,dispidBindingDataChangedEvent:4,dispidDocumentOpenEvent:5,dispidDocumentCloseEvent:6,dispidActiveViewChangedEvent:7,dispidDocumentThemeChangedEvent:8,dispidOfficeThemeChangedEvent:9,dispidActivationStatusChangedEvent:32,dispidTaskSelectionChangedEvent:56,dispidResourceSelectionChangedEvent:57,dispidViewSelectionChangedEvent:58,dispidDataNodeAddedEvent:60,dispidDataNodeReplacedEvent:61,dispidDataNodeDeletedEvent:62,dispidEventMax:63};OSF.XmlConstants={MaxXmlSize:4096,MaxElementDepth:10};OSF.Xpath3Provider=function(f,e){var a=this;a._xmldoc=(new DOMParser).parseFromString(f,"text/xml");a._evaluator=new XPathEvaluator;a._namespaceMapping={};a._defaultNamespace=null;for(var d=e.split(" "),b,c=0;c<d.length;++c){b=/xmlns="([^"]*)"/g.exec(d[c]);if(b){a._defaultNamespace=b[1];continue}b=/xmlns:([^=]*)="([^"]*)"/g.exec(d[c]);if(b){a._namespaceMapping[b[1]]=b[2];continue}}a._resolver=a};OSF.Xpath3Provider.prototype={lookupNamespaceURI:function(a){var b=this._namespaceMapping[a];return b||this._defaultNamespace},selectSingleNode:function(c,b){var a=this._evaluator.evaluate(c,b,this._resolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(a)return a.singleNodeValue;else return null},selectNodes:function(e,d){var a=this._evaluator.evaluate(e,d,this._resolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),c=[];if(a){var b=a.iterateNext();while(b){c.push(b);b=a.iterateNext()}}return c},getDocumentElement:function(){return this._xmldoc.documentElement}};OSF.IEXpathProvider=function(f,e){for(var a=null,c=["MSXML2.DOMDocument.6.0"],b=0;b<c.length;b++)try{a=new ActiveXObject(c[b]);a.setProperty("ResolveExternals",false);a.setProperty("ValidateOnParse",false);a.setProperty("ProhibitDTD",true);a.setProperty("MaxXMLSize",OSF.XmlConstants.MaxXmlSize);a.setProperty("MaxElementDepth",OSF.XmlConstants.MaxElementDepth);a.async=false;a.loadXML(f);a.setProperty("SelectionLanguage","XPath");a.setProperty("SelectionNamespaces",e);break}catch(d){Sys.Debug.trace("xml doc creating error:"+d)}this._xmldoc=a};OSF.IEXpathProvider.prototype={selectSingleNode:function(b,a){return a.selectSingleNode(b)},selectNodes:function(b,a){return a.selectNodes(b)},getDocumentElement:function(){return this._xmldoc.documentElement}};OSF.XmlProcessor=function(b,a){var c=Function._validateParams(arguments,[{name:"xml",type:String,mayBeNull:false},{name:"xmlNamespaces",type:String,mayBeNull:false}]);if(c)throw c;if(document.implementation&&document.implementation.hasFeature("XPath","3.0"))this._provider=new OSF.Xpath3Provider(b,a);else this._provider=new OSF.IEXpathProvider(b,a)};OSF.XmlProcessor.prototype={selectSingleNode:function(c,a){var b=Function._validateParams(arguments,[{name:"xpath",type:String,mayBeNull:false},{name:"contextNode",mayBeNull:true,optional:true}]);if(b)throw b;a=a||this._provider.getDocumentElement();return this._provider.selectSingleNode(c,a)},selectNodes:function(c,a){var b=Function._validateParams(arguments,[{name:"xpath",type:String,mayBeNull:false},{name:"contextNode",mayBeNull:true,optional:true}]);if(b)throw b;a=a||this._provider.getDocumentElement();return this._provider.selectNodes(c,a)},getDocumentElement:function(){return this._provider.getDocumentElement()},getNodeValue:function(b){var c=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(c)throw c;var a;if(b.text)a=b.text;else a=b.textContent;return a},_getAttributeLocalName:function(a){var b;if(a.localName)b=a.localName;else b=a.baseName;return b},readAttributes:function(e,c,h){var f=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false},{name:"attributesToRead",type:Object,mayBeNull:false},{name:"objectToFill",type:Object,mayBeNull:false}]);if(f)throw f;for(var a,d,b=0;b<e.attributes.length;b++){a=e.attributes[b];d=this._getAttributeLocalName(a);for(var g in c)if(d===g)h[c[g]]=a.value}}};var SafeSerializer=function(){function a(){}a.prototype.Serialize=function(a){try{return Sys.Serialization.JavaScriptSerializer.serialize(a)}catch(b){return null}};a.prototype.Deserialize=function(a){try{return Sys.Serialization.JavaScriptSerializer.deserialize(a,true)}catch(b){return null}};return a}(),AppsDataCacheManager=function(){function a(a,b){this._localStorage=a;this._serializer=b}a.prototype.GetCacheItem=function(f,c,d){if(typeof c==="undefined")c=true;var e=this._localStorage.getItem(f);if(e){var b=this._serializer.Deserialize(e);if(c){var g=new Date;if(Math.abs(g.getTime()-b.createdOn)<a.msPerDay*b.refreshRate)return b.data;else{this._localStorage.removeItem(f);if(d)d["cacheExpired"]=true}}else return b.data}};a.prototype.SetCacheItem=function(e,d,b){b=b||a.defaultRefreshRateInDays;var f=new Date,c={data:d,createdOn:f.getTime(),refreshRate:b};this._localStorage.setItem(e,this._serializer.Serialize(c))};a.prototype.RemoveCacheItem=function(a){this._localStorage.removeItem(a)};a.prototype.RemoveAll=function(c){for(var b=this._localStorage.getKeysWithPrefix(c),a=0,d=b.length;a<d;a++)this._localStorage.removeItem(b[a])};a.prototype.RemoveMatches=function(c){for(var d=this._localStorage.getKeysWithPrefix(""),a=0,g=d.length;a<g;a++)for(var e=d[a],b=0,f=c.length;b<f;b++)if(c[b].test(e)){this._localStorage.removeItem(e);break}};a.defaultRefreshRateInDays=3;a.msPerDay=8.64e7;return a}(),OmexDataProvider=function(){var b=false,c=true,d=null;function a(a){this._cacheManager=a;this._cid="0"}a.GetInstance=function(b){if(a.instance==d)a.instance=new a(b);return a.instance};a.prototype.GetCacheKeyPrefix=function(b){OSF.OUtil.validateParamObject(b,{anonymous:{type:Boolean,mayBeNull:c}},d);if(b.anonymous==d||b.anonymous)return a.anonymousCacheKeyPrefix;return a.gatedCacheKeyPrefix};a.prototype.GetCustomerId=function(){return this._cid};a.prototype.SetCustomerId=function(a){this._cid=a};a.prototype.AllCached=function(a,d){if(a&&!a.clearCache&&!a.clearToken&&!a.clearEntitlement&&!a.clearAppState&&!a.clearManifest)if(this.KilledAppsCached(a)&&this.AppStateCached(a,d)&&this.ManifestAndETokenCached(a,d))return c;return b};a.prototype.KilledAppsCached=function(f){var c=this.GetCacheKeyPrefix(f),e=OSF.OUtil.formatString(a.killedAppsWS.cacheKey,c),g=this._cacheManager.GetCacheItem(e,b);return g!=d};a.prototype.GetKilledApps=function(f,e,g){OSF.OUtil.validateParamObject(e,{clientName:{type:String,mayBeNull:c},clientVersion:{type:String,mayBeNull:c}},g);e.clearKilledApps=e.clearKilledApps||b;var h={context:f,statusCode:OSF.ProxyCallStatusCode.Succeeded,value:d,cached:b},i=OSF.OUtil.formatString(a.killedAppsWS.cacheKey,this.GetCacheKeyPrefix(f));if(e.clearKilledApps)this._cacheManager.RemoveCacheItem(i);else{var j=this._cacheManager.GetCacheItem(i,c,e.errors);if(j){h.value=j;h.cached=c;g(h);return}}f.manifestManager._invokeProxyMethodAsync(f,"OMEX_getKilledAppsAsync",g,e)};a.prototype.SetKilledAppsCache=function(f,c){OSF.OUtil.validateParamObject(c,{refreshRate:{type:String,mayBeNull:b}},d);var e=OSF.OUtil.formatString(a.killedAppsWS.cacheKey,this.GetCacheKeyPrefix(f));this._cacheManager.SetCacheItem(e,c,c.refreshRate/a.hourToDayConversionFactor)};a.prototype.AppStateCached=function(f,c){OSF.OUtil.validateParamObject(c,{assetID:{type:String,mayBeNull:b},contentMarket:{type:String,mayBeNull:b}},d);var e=OSF.OUtil.formatString(a.appStateWS.cacheKey,this.GetCacheKeyPrefix(f),c.contentMarket,c.assetID),g=this._cacheManager.GetCacheItem(e,b);return g!=d};a.prototype.GetAppState=function(f,e,g){OSF.OUtil.validateParamObject(e,{assetID:{type:String,mayBeNull:b},contentMarket:{type:String,mayBeNull:b},clientName:{type:String,mayBeNull:c},clientVersion:{type:String,mayBeNull:c}},g);e.clearAppState=e.clearAppState||b;var h={context:f,statusCode:OSF.ProxyCallStatusCode.Succeeded,value:d,cached:b},i=OSF.OUtil.formatString(a.appStateWS.cacheKey,this.GetCacheKeyPrefix(f),e.contentMarket,e.assetID);if(e.clearAppState)this._cacheManager.RemoveCacheItem(i);else{var j=this._cacheManager.GetCacheItem(i,c,e.errors);if(j){h.value=j;h.cached=c;g(h);return}}f.manifestManager._invokeProxyMethodAsync(f,"OMEX_getAppStateAsync",g,e)};a.prototype.SetAppStateCache=function(f,c){OSF.OUtil.validateParamObject(c,{refreshRate:{type:String,mayBeNull:b}},d);var e=f.referenceInUse,g=OSF.OUtil.formatString(a.appStateWS.cacheKey,this.GetCacheKeyPrefix(f),e.storeLocator,e.id);this._cacheManager.SetCacheItem(g,c,c.refreshRate/a.hourToDayConversionFactor)};a.prototype.ManifestAndETokenCached=function(f,c){OSF.OUtil.validateParamObject(c,{assetID:{type:String,mayBeNull:b},contentMarket:{type:String,mayBeNull:b}},d);var e;if(f.anonymous==d||f.anonymous)e=OSF.OUtil.formatString(a.anonymousAppInstallInfoWS.cacheKey,c.assetID,c.contentMarket);else e=OSF.OUtil.formatString(a.authenticatedAppInstallInfoWS.cacheKey,this._cid,c.assetID,c.userContentMarket,c.assetContentMarket);var g=this._cacheManager.GetCacheItem(e,b);return g!=d};a.prototype.GetManifestAndEToken=function(g,e,j){var k="OMEX_getManifestAndETokenAsync",l=this;OSF.OUtil.validateParamObject(e,{assetID:{type:String,mayBeNull:b},applicationName:{type:String,mayBeNull:b},contentMarket:{type:String,mayBeNull:c},userContentMarket:{type:String,mayBeNull:c},assetContentMarket:{type:String,mayBeNull:c},clientName:{type:String,mayBeNull:c},clientVersion:{type:String,mayBeNull:c}},j);e.clearToken=e.clearToken||b;e.clearManifest=e.clearManifest||b;var i={context:g,statusCode:OSF.ProxyCallStatusCode.Succeeded,value:d,cached:b},h;if(g.anonymous==d||g.anonymous)h=OSF.OUtil.formatString(a.anonymousAppInstallInfoWS.cacheKey,e.assetID,e.contentMarket);else h=OSF.OUtil.formatString(a.authenticatedAppInstallInfoWS.cacheKey,l._cid,e.assetID,e.userContentMarket,e.assetContentMarket);if(e.clearManifest)l._cacheManager.RemoveCacheItem(h);else{var f=l._cacheManager.GetCacheItem(h,c,e.errors);if(f){if(e.clearToken||f.tokenExpirationDate&&new Date(f.tokenExpirationDate)<=new Date){delete f.etoken;delete f.tokenExpirationDate;delete f.entitlementType}if((g.anonymous==d||g.anonymous||f.etoken)&&f.manifest){i.value=f;i.cached=c;j(i);return}}if(!g.anonymous){h=OSF.OUtil.formatString(a.anonymousAppInstallInfoWS.cacheKey,e.assetID,e.userContentMarket);var m=l._cacheManager.GetCacheItem(h,c,e.errors);if(m&&m.manifest){var n=function(a){var e=a.context;if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){var c=a.value,f=parseInt(c.status);if(f===OSF.OmexClientAppStatus.OK)c.manifest=m.manifest;i.context=e;i.value=c;j(i)}else j({context:e,statusCode:OSF.ProxyCallStatusCode.Failed,value:d,cached:b})};if(!f||!f.etoken){e.clientAppInfoReturnType=OSF.ClientAppInfoReturnType.etokenOnly;g.manifestManager._invokeProxyMethodAsync(g,k,n,e);return}}}}g.manifestManager._invokeProxyMethodAsync(g,k,j,e)};a.prototype.SetManifestAndETokenCache=function(c,f){var b=c.referenceInUse,e;if(c.anonymous==d||c.anonymous)e=OSF.OUtil.formatString(a.anonymousAppInstallInfoWS.cacheKey,b.id,b.storeLocator);else e=OSF.OUtil.formatString(a.authenticatedAppInstallInfoWS.cacheKey,this._cid,b.id,b.storeLocator,c.osfControl._omexEntitlement.contentMarket);this._cacheManager.SetCacheItem(e,f,a.manifestRefreshRate)};a.prototype.RemoveManifestAndEToken=function(d){var b=".*",c=[];c.push(new RegExp(OSF.OUtil.formatString(a.authenticatedAppInstallInfoWS.cacheKey,b,d,b,b),"i"));this._cacheManager.RemoveMatches(c)};a.prototype.AppDetailsCached=function(k,f){var d=[];for(var i in f){d=f[i].split(",");break}for(var j=[],e=0;e<d.length;++e){var g=OSF.OUtil.formatString(a.appDetailKey,d[e]),h=this._cacheManager.GetCacheItem(g,b);if(!h)return b}return c};a.prototype.GetAppDetails=function(f,e,i){OSF.OUtil.validateParamObject(e,{assetID:{type:String,mayBeNull:b},contentMarket:{type:String,mayBeNull:b},clientName:{type:String,mayBeNull:c},clientVersion:{type:String,mayBeNull:c}},i);e.clearCache=e.clearCache||b;e.appDetails=[];if(e.clearCache)this._cacheManager.RemoveAll(a.ungatedCacheKeyPrefix);else{for(var k=e.assetID.split(","),h=[],g=0;g<k.length;++g){var m=OSF.OUtil.formatString(a.appDetailKey,k[g]),l=this._cacheManager.GetCacheItem(m,c,e.errors);if(l)e.appDetails.push(l);else h.push(k[g])}if(h.length===0){var j={context:f,statusCode:OSF.ProxyCallStatusCode.Succeeded,value:d,cached:b};j.value=e.appDetails;j.cached=c;i(j);return}e.assetID=h.join(",")}f.appDetails=e.appDetails;f.manifestManager._invokeProxyMethodAsync(f,"OMEX_getAppDetailsAsync",i,e)};a.prototype.SetAppDetailsCache=function(f,d){for(var b,e,c=0;c<d.length;++c){b=d[c];e=OSF.OUtil.formatString(a.appDetailKey,b.assetId);this._cacheManager.SetCacheItem(e,b)}};a.anonymousCacheKeyPrefix="__OSF_ANONYMOUS_OMEX.";a.gatedCacheKeyPrefix="__OSF_GATED_OMEX.";a.ungatedCacheKeyPrefix="__OSF_OMEX.";a.manifestRefreshRate=5*365;a.hourToDayConversionFactor=24;a.anonymousAppInstallInfoWS={url:"/appinstall/unauthenticated?cmu={0}&assetid={1}&ret=0",cacheKey:a.anonymousCacheKeyPrefix+"appInstallInfo.{0}.{1}"};a.authenticatedAppInstallInfoWS={url:"/appinstall/authenticated?cmu={0}&cmf={1}&assetid={2}&ret={3}&rt=xml",cacheKey:a.gatedCacheKeyPrefix+"appinstall_authenticated.{0}.{1}.{2}.{3}"};a.killedAppsWS={url:"/appinfo/query?rt=xml",cacheKey:"{0}killedApps"};a.appStateWS={url:"/appstate/query?ma={0}:{1}",cacheKey:"{0}appState.{1}.{2}"};a.appDetailKey="__OSF_OMEX.appDetails.{0}";return a}(),definePropertySave,isDefinePropertySupported=false;try{Object.defineProperty({},"myTestProperty",{"get":function(){return this.desc},"set":function(a){this.desc=a}});isDefinePropertySupported=true}catch(e){definePropertySave=Object.defineProperty;Object.defineProperty=function(){}}var OSFLog;(function(g){var e="SessionId",d="ErrorResult",b="AssetId",c="CorrelationId",a=true,f=function(){function b(a){this._table=a;this._fields={}}Object.defineProperty(b.prototype,"Fields",{"get":function(){return this._fields},enumerable:a,configurable:a});Object.defineProperty(b.prototype,"Table",{"get":function(){return this._table},enumerable:a,configurable:a});b.prototype.SerializeFields=function(){};b.prototype.SetSerializedField=function(b,a){if(typeof a!=="undefined"&&a!==null)this._serializedFields[b]=a.toString()};b.prototype.SerializeRow=function(){var a=this;a._serializedFields={};a.SetSerializedField("Table",a._table);a.SerializeFields();return JSON.stringify(a._serializedFields)};return b}();g.BaseUsageData=f;var l=function(t){var s="Stage11Time",r="Stage10Time",q="Stage9Time",p="Stage8Time",o="Stage7Time",n="Stage6Time",m="Stage5Time",l="Stage4Time",k="Stage3Time",j="Stage2Time",i="Stage1Time",h="InstanceId",g="ActivationInfo",f="AppInfo";__extends(e,t);function e(){t.call(this,"AppLoadTime")}Object.defineProperty(e.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,h,{"get":function(){return this.Fields[h]},"set":function(a){this.Fields[h]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,i,{"get":function(){return this.Fields[i]},"set":function(a){this.Fields[i]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,j,{"get":function(){return this.Fields[j]},"set":function(a){this.Fields[j]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,k,{"get":function(){return this.Fields[k]},"set":function(a){this.Fields[k]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,l,{"get":function(){return this.Fields[l]},"set":function(a){this.Fields[l]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,m,{"get":function(){return this.Fields[m]},"set":function(a){this.Fields[m]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,n,{"get":function(){return this.Fields[n]},"set":function(a){this.Fields[n]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,o,{"get":function(){return this.Fields[o]},"set":function(a){this.Fields[o]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,p,{"get":function(){return this.Fields[p]},"set":function(a){this.Fields[p]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,q,{"get":function(){return this.Fields[q]},"set":function(a){this.Fields[q]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,r,{"get":function(){return this.Fields[r]},"set":function(a){this.Fields[r]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,s,{"get":function(){return this.Fields[s]},"set":function(a){this.Fields[s]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});e.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(c,a.CorrelationId);a.SetSerializedField(f,a.AppInfo);a.SetSerializedField(g,a.ActivationInfo);a.SetSerializedField(h,a.InstanceId);a.SetSerializedField(b,a.AssetId);a.SetSerializedField(i,a.Stage1Time);a.SetSerializedField(j,a.Stage2Time);a.SetSerializedField(k,a.Stage3Time);a.SetSerializedField(l,a.Stage4Time);a.SetSerializedField(m,a.Stage5Time);a.SetSerializedField(n,a.Stage6Time);a.SetSerializedField(o,a.Stage7Time);a.SetSerializedField(p,a.Stage8Time);a.SetSerializedField(q,a.Stage9Time);a.SetSerializedField(r,a.Stage10Time);a.SetSerializedField(s,a.Stage11Time);a.SetSerializedField(d,a.ErrorResult)};return e}(f);g.AppLoadTimeUsageData=l;var j=function(f){var b="NotificationClickInfo";__extends(e,f);function e(){f.call(this,"AppNotification")}Object.defineProperty(e.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});e.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(c,a.CorrelationId);a.SetSerializedField(d,a.ErrorResult);a.SetSerializedField(b,a.NotificationClickInfo)};return e}(f);g.AppNotificationUsageData=j;var k=function(o){var n="AppSizeHeight",m="AppSizeWidth",l="ClientId",k="HostVersion",j="Host",i="UserId",h="Browser",g="AppURL",f="AppId";__extends(d,o);function d(){o.call(this,"AppActivated")}Object.defineProperty(d.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,h,{"get":function(){return this.Fields[h]},"set":function(a){this.Fields[h]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,i,{"get":function(){return this.Fields[i]},"set":function(a){this.Fields[i]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,j,{"get":function(){return this.Fields[j]},"set":function(a){this.Fields[j]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,k,{"get":function(){return this.Fields[k]},"set":function(a){this.Fields[k]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,l,{"get":function(){return this.Fields[l]},"set":function(a){this.Fields[l]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,m,{"get":function(){return this.Fields[m]},"set":function(a){this.Fields[m]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,n,{"get":function(){return this.Fields[n]},"set":function(a){this.Fields[n]=a},enumerable:a,configurable:a});d.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(c,a.CorrelationId);a.SetSerializedField(e,a.SessionId);a.SetSerializedField(f,a.AppId);a.SetSerializedField(g,a.AppURL);a.SetSerializedField(b,a.AssetId);a.SetSerializedField(h,a.Browser);a.SetSerializedField(i,a.UserId);a.SetSerializedField(j,a.Host);a.SetSerializedField(k,a.HostVersion);a.SetSerializedField(l,a.ClientId);a.SetSerializedField(m,a.AppSizeWidth);a.SetSerializedField(n,a.AppSizeHeight)};return d}(f);g.AppActivatedUsageData=k;var m=function(i){var g="CloseMethod",f="OpenTime",d="AppSizeFinalHeight",c="AppSizeFinalWidth",b="FocusTime";__extends(h,i);function h(){i.call(this,"AppClosed")}Object.defineProperty(h.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});h.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(e,a.SessionId);a.SetSerializedField(b,a.FocusTime);a.SetSerializedField(c,a.AppSizeFinalWidth);a.SetSerializedField(d,a.AppSizeFinalHeight);a.SetSerializedField(f,a.OpenTime);a.SetSerializedField(g,a.CloseMethod)};return h}(f);g.AppClosedUsageData=m;var n=function(i){var g="ErrorType",f="ResponseTime",d="Parameters",c="APIID",b="APIType";__extends(h,i);function h(){i.call(this,"APIUsage")}Object.defineProperty(h.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});h.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(e,a.SessionId);a.SetSerializedField(b,a.APIType);a.SetSerializedField(c,a.APIID);a.SetSerializedField(d,a.Parameters);a.SetSerializedField(f,a.ResponseTime);a.SetSerializedField(g,a.ErrorType)};return h}(f);g.APIUsageUsageData=n;var i=function(f){var c="OperationMetadata";__extends(e,f);function e(){f.call(this,"AppManagementMenu")}Object.defineProperty(e.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});e.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(b,a.AssetId);a.SetSerializedField(c,a.OperationMetadata);a.SetSerializedField(d,a.ErrorResult)};return e}(f);g.AppManagementMenuUsageData=i;var h=function(i){var g="LastActiveTabCount",f="LastActiveTab",e="DialogState",d="TrustPageSessionTime",c="TotalSessionTime";__extends(h,i);function h(){i.call(this,"InsertionDialogSession")}Object.defineProperty(h.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});h.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(b,a.AssetId);a.SetSerializedField(c,a.TotalSessionTime);a.SetSerializedField(d,a.TrustPageSessionTime);a.SetSerializedField(e,a.DialogState);a.SetSerializedField(f,a.LastActiveTab);a.SetSerializedField(g,a.LastActiveTabCount)};return h}(f);g.InsertionDialogSessionUsageData=h})(OSFLog||(OSFLog={}));var Telemetry;(function(a){var b=null;"use strict";(function(a){var c="verboseEx",b="unexpected";a[a[b]=10]=b;a[a["warning"]=15]="warning";a[a["info"]=50]="info";a[a["verbose"]=100]="verbose";a[a[c]=200]=c})(a.ULSTraceLevel||(a.ULSTraceLevel={}));var q=a.ULSTraceLevel;(function(a){var f="msoulscat_Osf_InsertionDialogSession",e="msoulscat_Osf_AppManagementMenu",d="msoulscat_Osf_Runtime",c="msoulscat_Osf_Notification",b="msoulscat_Osf_Latency";a[a[b]=1401]=b;a[a[c]=1402]=c;a[a[d]=1403]=d;a[a[e]=1404]=e;a[a[f]=1405]=f})(a.ULSCat||(a.ULSCat={}));var r=a.ULSCat,h;(function(a){var d="IsAnonymous",c="InsertionDialogClosed",b="ConfirmationDialogCancel";a[a[b]=256]=b;a[a[c]=512]=c;a[a[d]=1024]=d})(h||(h={}));var f;(function(a){var e="TrustPageVisited",d="Canceled",c="Inserted",b="Undefined";a[a[b]=0]=b;a[a[c]=1]=c;a[a[d]=2]=d;a[a["Closed"]=3]="Closed";a[a[e]=8]=e})(f||(f={}));var c=function(){var a=true;function b(){this.timeValue=0}b.prototype.Start=function(){this.timeValue=-(new Date).getTime();this.finishedMeasurement=false};b.prototype.Stop=function(){if(this.timeValue<0){this.timeValue+=(new Date).getTime();this.finishedMeasurement=a}};Object.defineProperty(b.prototype,"Finished",{"get":function(){return this.finishedMeasurement},enumerable:a,configurable:a});Object.defineProperty(b.prototype,"ElapsedTime",{"get":function(){var a=this.timeValue;if(!this.Finished&&a<0)a=Math.abs(a)-(new Date).getTime();return a},enumerable:a,configurable:a});return b}();a.LatencyStopwatch=c;var p=function(){function a(){}return a}();a.Context=p;var d=function(){function a(){}a.SendULSTraceTag=function(a,b,d,c){if(!Microsoft.Office.WebExtension.FULSSupported)return;Diag.UULS.trace(c,a,b,d)};return a}(),i=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),6062431)};a.category=1402;a.level=50;return a}();a.NotificationLogger=i;var g=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),0)};a.category=1404;a.level=50;return a}();a.AppManagementMenuLogger=g;var j=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),4748055)};a.category=1401;a.level=50;return a}();a.LatencyLogger=j;var e=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),0)};a.category=1405;a.level=50;return a}();a.InsertionDialogSessionLogger=e;var n=function(){function a(){}a.LogNotification=function(c,d,b){var a=new OSFLog.AppNotificationUsageData;a.CorrelationId=c;a.ErrorResult=d;a.NotificationClickInfo=b;i.Instance().LogData(a)};return a}();a.AppNotificationHelper=n;var l=function(){function a(){}a.LogAppManagementMenuAction=function(c,b,i,d,f,h){var a=new OSFLog.AppManagementMenuUsageData,e=c.toLowerCase().indexOf("wa")===0?parseInt(c.substring(2),10):parseInt(c,10);if(d)b|=512;if(f)b|=1024;a.AssetId=e;a.OperationMetadata=b;a.ErrorResult=h;g.Instance().LogData(a)};return a}();a.AppManagementMenuHelper=l;var o=function(){var m="Stage11Time",l="Stage10Time",k="Stage9Time",i="Stage8Time",h="Stage7Time",g="Stage5Time",f="Stage4Time",e="Stage2Time",d="Stage1Time";function a(){}a.ActivationStart=function(b,o,p,j,n){a.activatingNumber++;b.LoadTime=new OSFLog.AppLoadTimeUsageData;b.Timers={};b.LoadTime.CorrelationId=j;b.LoadTime.AppInfo=o;b.LoadTime.ActivationInfo=0;b.LoadTime.InstanceId=n;b.LoadTime.AssetId=p;b.LoadTime.Stage1Time=0;b.Timers[d]=new c;b.LoadTime.Stage2Time=0;b.Timers[e]=new c;b.LoadTime.Stage3Time=0;b.LoadTime.Stage4Time=0;b.Timers[f]=new c;b.LoadTime.Stage5Time=0;b.Timers[g]=new c;b.LoadTime.Stage6Time=a.activatingNumber;b.LoadTime.Stage7Time=0;b.Timers[h]=new c;b.LoadTime.Stage8Time=0;b.Timers[i]=new c;b.LoadTime.Stage9Time=0;b.Timers[k]=new c;b.LoadTime.Stage10Time=0;b.Timers[l]=new c;b.LoadTime.Stage11Time=0;b.Timers[m]=new c;b.LoadTime.ErrorResult=0;a.StartStopwatch(b,d)};a.ActivationEnd=function(b){a.ActivateEndInternal(b)};a.PageStart=function(b){a.StartStopwatch(b,e)};a.PageLoaded=function(b){a.StopStopwatch(b,e)};a.ServerCallStart=function(b){a.StartStopwatch(b,f)};a.ServerCallEnd=function(b){a.StopStopwatch(b,f)};a.AuthenticationStart=function(b){a.StartStopwatch(b,g)};a.AuthenticationEnd=function(b){a.StopStopwatch(b,g)};a.EntitlementCheckStart=function(b){a.StartStopwatch(b,h)};a.EntitlementCheckEnd=function(b){a.StopStopwatch(b,h)};a.KilledAppsCheckStart=function(b){a.StartStopwatch(b,i)};a.KilledAppsCheckEnd=function(b){a.StopStopwatch(b,i)};a.AppStateCheckStart=function(b){a.StartStopwatch(b,k)};a.AppStateCheckEnd=function(b){a.StopStopwatch(b,k)};a.ManifestRequestStart=function(b){a.StartStopwatch(b,l)};a.ManifestRequestEnd=function(b){a.StopStopwatch(b,l)};a.OfficeJSStartToLoad=function(b){a.StartStopwatch(b,m)};a.OfficeJSLoaded=function(b){a.StopStopwatch(b,m)};a.SetAnonymousFlag=function(c,b){a.SetActivationInfoField(c,a.ConvertFlagToBit(b),2,0)};a.SetRetryCount=function(c,b){a.SetActivationInfoField(c,b,3,2)};a.SetManifestTrustCachedFlag=function(c,b){a.SetActivationInfoField(c,a.ConvertFlagToBit(b),2,5)};a.SetManifestDataCachedFlag=function(c,b){a.SetActivationInfoField(c,a.ConvertFlagToBit(b),2,7)};a.SetOmexHasEntitlementFlag=function(c,b){a.SetActivationInfoField(c,a.ConvertFlagToBit(b),2,9)};a.SetManifestDataInvalidFlag=function(c,b){a.SetActivationInfoField(c,a.ConvertFlagToBit(b),2,11)};a.SetAppStateDataCachedFlag=function(c,b){a.SetActivationInfoField(c,a.ConvertFlagToBit(b),2,13)};a.SetAppStateDataInvalidFlag=function(c,b){a.SetActivationInfoField(c,a.ConvertFlagToBit(b),2,15)};a.SetErrorResult=function(b,c){if(b.LoadTime){b.LoadTime.ErrorResult=c;a.ActivateEndInternal(b)}};a.ConvertFlagToBit=function(a){if(a)return 2;else return 1};a.SetActivationInfoField=function(b,e,c,d){if(b.LoadTime){a.UpdateActivatingNumber(b);b.LoadTime.ActivationInfo=a.SetBitField(b.LoadTime.ActivationInfo,e,c,d)}};a.SetBitField=function(d,e,c,a){var f=Math.pow(2,c)-1<<a,b=d&~f;return b|e<<a};a.StopStopwatch=function(b,c){if(b.LoadTime&&b.Timers&&b.Timers[c]){b.Timers[c].Stop();a.UpdateActivatingNumber(b)}};a.StartStopwatch=function(b,c){if(b.LoadTime&&b.Timers&&b.Timers[c]){b.Timers[c].Start();a.UpdateActivatingNumber(b)}};a.UpdateActivatingNumber=function(b){if(b.LoadTime)b.LoadTime.Stage6Time=b.LoadTime.Stage6Time>a.activatingNumber?b.LoadTime.Stage6Time:a.activatingNumber};a.ActivateEndInternal=function(c){if(c.LoadTime){a.StopStopwatch(c,d);if(c.Timers)for(var e in c.Timers)if(c.Timers[e].ElapsedTime!=b)c.LoadTime[e]=c.Timers[e].ElapsedTime;j.Instance().LogData(c.LoadTime);c.LoadTime=b;a.activatingNumber--}};a.activatingNumber=0;return a}();a.AppLoadTimeHelper=o;var m=function(){function a(){}a.LogProxyFailure=function(e,g,f){var c;if(e==b)e="";c=OSF.OUtil.formatString("appCorrelationId:{0}, methodName:{1}",e,g);Object.keys(f).forEach(function(d){var a=f[d];if(a!=b)a=a.toString();c+=", "+d+":"+a});d.SendULSTraceTag(a.category,15,c,6062432)};a.LogExceptionTag=function(g,e,f,h){var c=g;if(e){if(e.name)c+=" Exception name:"+e.name+".";if(e.paramName)c+=" Param name:"+e.paramName+"."}if(f!=b)c+=" AppCorrelationId:"+f+".";c+=OSF.OUtil.formatString(" SourceTag: {0}.",h);d.SendULSTraceTag(a.category,15,c,6062433)};a.category=1403;return a}();a.RuntimeTelemetryHelper=m;var k=function(){function a(){}a.LogInsertionDialogSession=function(c,g,d,j,i,f){var a=new OSFLog.InsertionDialogSessionUsageData,h=c.toLowerCase().indexOf("wa")===0?parseInt(c.substring(2),10):parseInt(c,10),b=0;if(j)b|=1;else b|=2;if(d>0)b|=8;a.AssetId=h;a.TotalSessionTime=g;a.TrustPageSessionTime=d;a.DialogState=b;a.LastActiveTab=i;a.LastActiveTabCount=f;e.Instance().LogData(a)};return a}();a.InsertionDialogSessionHelper=k})(Telemetry||(Telemetry={}));if(!isDefinePropertySupported)Object.defineProperty=definePropertySave;OSF.HostType={Excel:"Excel",Outlook:"Outlook",Access:"Access",PowerPoint:"PowerPoint",Word:"Word",Sway:"Sway"};OSF.HostPlatform={Web:"Web"};OSF.HostSpecificFileVersion="16.00";OSF.getAppVerCode=function(c){var b="Invalid appName.",a;switch(c){case OSF.AppName.ExcelWebApp:a="excel.exe";break;case OSF.AppName.AccessWebApp:a="ZAC";break;case OSF.AppName.PowerpointWebApp:a="WAP";break;case OSF.AppName.WordWebApp:a="WAW";break;default:Sys.Debug.trace(b);throw b}return a};OSF.Capability={Mailbox:"Mailbox",Document:"Document",Workbook:"Workbook",Project:"Project",Presentation:"Presentation",Database:"Database",Sway:"Sway"};OSF.HostCapability={Excel:OSF.Capability.Workbook,Outlook:OSF.Capability.Mailbox,Access:OSF.Capability.Database,PowerPoint:OSF.Capability.Presentation,Word:OSF.Capability.Document,Sway:OSF.Capability.Sway};OSF.OsfControlTarget={InContent:0,TaskPane:1,Contextual:2};OSF.OsfControlPermission={Restricted:1,ReadDocument:2,WriteDocument:4,ReadWriteDocument:6,ReadItem:32,ReadWriteMailbox:64,ReadAllDocument:131};OSF.OsfControlStatus={NotActivated:1,Activated:2,AppStoreNotReachable:3,InvalidOsfControl:4,UnsupportedStore:5,UnknownStore:6,ActivationFailed:7,NotSandBoxSupported:8};OSF.StoreType={OMEX:"omex",SPCatalog:"spcatalog",SPApp:"spapp",FileSystem:"filesystem",Exchange:"exchange",Registry:"registry"};OSF.ManifestIdIssuer={Microsoft:"Microsoft",Custom:"Custom"};OSF.OmexClientAppStatus={OK:1,UnknownAssetId:2,KilledAsset:3,NoEntitlement:4,DownloadsExceeded:5,Expired:6,Invalid:7,Revoked:8,ServerError:9,BadRequest:10,LimitedTrial:11,TrialNotSupported:12,EntitlementDeactivated:13,VersionMismatch:14,VersionNotSupported:15};OSF.OmexState={Killed:0,OK:1,Withdrawn:2,Flagged:3,DeveloperWithdrawn:4};OSF.OmexTrialType={None:0,Office:1,External:2};OSF.OmexEntitlementType={Free:"free",Trial:"trial",Paid:"paid"};OSF.OmexAuthNStatus={NotAttempted:-1,CheckFailed:0,Authenticated:1,Anonymous:2,Unknown:3};OSF.OmexRemoveAppStatus={Failed:0,Success:1};OSF.OfficeAppType={ContentApp:OSF.OsfControlTarget.InContent,TaskPaneApp:OSF.OsfControlTarget.TaskPane,MailApp:OSF.OsfControlTarget.Contextual};OSF.FormFactor={Default:"DefaultSettings",Desktop:"DesktopSettings",Tablet:"TabletSettings",Phone:"PhoneSettings"};OSF.OsfOfficeExtensionManagerPerfMarker={GetEntitlementStart:"Agave.OfficeExtensionManager.GetEntitlementStart",GetEntitlementEnd:"Agave.OfficeExtensionManager.GetEntitlementEnd"};OSF.OsfControlActivationPerfMarker={ActivationStart:"Agave.AgaveActivationStart",ActivationEnd:"Agave.AgaveActivationEnd",DeactivationStart:"Agave.AgaveDeactivationStart",DeactivationEnd:"Agave.AgaveDeactivationEnd",SelectionTimeout:"Agave.AgaveSelectionTimeout"};OSF.NotificationUxPerfMarker={RenderLoadingAnimationStart:"Agave.NotificationUx.RenderLoadingAnimationStart",RenderLoadingAnimationEnd:"Agave.NotificationUx.RenderLoadingAnimationEnd",RemoveLoadingAnimationStart:"Agave.NotificationUx.RemoveLoadingAnimationStart",RemoveLoadingAnimationEnd:"Agave.NotificationUx.RemoveLoadingAnimationEnd",RenderStage1Start:"Agave.NotificationUx.RenderStage1Start",RenderStage1End:"Agave.NotificationUx.RenderStage1End",RemoveStage1Start:"Agave.NotificationUx.RemoveStage1Start",RemoveStage1End:"Agave.NotificationUx.RemoveStage1End",RenderStage2Start:"Agave.NotificationUx.RenderStage2Start",RenderStage2End:"Agave.NotificationUx.RenderStage2End",RemoveStage2Start:"Agave.NotificationUx.RemoveStage2Start",RemoveStage2End:"Agave.NotificationUx.RemoveStage2End"};OSF.ProxyCallStatusCode={Succeeded:1,Failed:0,ProxyNotReady:-1};OSF.Constants={FileVersion:"16.0.3811.1000",ThreePartsFileVersion:"16.0.3811",OmexAnonymousServiceExtension:"/anonymousserviceextension.aspx",OmexGatedServiceExtension:"/gatedserviceextension.aspx",OmexUnGatedServiceExtension:"/ungatedserviceextension.aspx",Http:"http",Https:"https",ProtocolSeparator:"://",SignInRedirectUrl:"/logontoliveforwac.aspx?returnurl=",ETokenParameterName:"et",ActivatedCacheKey:"__OSF_RUNTIME_.Activated.{0}.{1}.{2}",AuthenticatedConnectMaxTries:3,IgnoreSandBoxSupport:"Ignore_SandBox_Support",IEUpgradeUrl:"http://office.microsoft.com/redir/HA102789344.aspx",OmexForceAnonymousParamName:"SKAV",OmexForceAnonymousParamValue:"274AE4CD-E50B-4342-970E-1E7F36C70037",EndPointInternalSuffix:"_internal"};var _omexXmlNamespaces='xmlns="urn:schemas-microsoft-com:office:office" xmlns:o="urn:schemas-microsoft-com:office:office"';OSF.AppVersion={access:"ZAC150",excel:"ZXL150",excelwebapp:"WAE160",outlook:"ZOL150",outlookwebapp:"MOW150",powerpoint:"ZPP151",powerpointwebapp:"WAP160",project:"ZPJ150",word:"ZWD150",wordwebapp:"WAW160"};OSF.AppSubType={Taskpane:1,Content:2,Contextual:3,Dictionary:4};OSF.ClientAppInfoReturnType={urlOnly:0,etokenOnly:1,both:2};function _getAppSubType(b){var a;if(b===0)a=OSF.AppSubType.Content;else if(b===1)a=OSF.AppSubType.Taskpane;else throw Error.argument("officeExtentionTarget");return a}function _getAppVersion(b){var a=OSF.AppVersion[b.toLowerCase()];if(typeof a=="undefined")throw Error.argument("applicationName");return a}function _invokeCallbackTag(g,h,l,k,a,m){var b=k;if(g){try{var d={status:h,result:l,failureInfo:null},e=function(a,c,b){if(a.failureInfo===null)a.failureInfo={};a.failureInfo[c]=b};if(a){var f=-1;if(a.get_statusCode)f=a.get_statusCode();if(!b)if(a.get_timedOut&&a.get_timedOut())b="Request timed out.";else if(a.get_aborted&&a.get_aborted())b="Request aborted.";if(f>=400||h===statusCode.Failed||b){e(d,"statusCode",f);e(d,"tagId",m);var c=a.get_webRequest();if(c){c.getResolvedUrl&&e(d,"url",c.getResolvedUrl());if(a.getResponseHeader&&c.get_userContext&&c.get_userContext()&&!c.get_userContext().correlationId){var j=a.getResponseHeader("X-CorrelationId");e(d,"correlationId",j)}}}}if(b){e(d,"message",b);Sys.Debug.trace(b)}}catch(i){Sys.Debug.trace("Encountered exception with logging: "+i)}g(d)}}var _serviceEndPoint=null,_defaultRefreshRate=3,_msPerDay=8.64e7,_defaultTimeout=6e4,_officeVersionHeader="X-Office-Version",_hourToDayConversionFactor=24,_buildParameter="&build=",_expectedVersionParameter="&expver=",_queryStringParameters={clientName:"client",clientVersion:"cv"},statusCode={Succeeded:1,Failed:0};function _sendWebRequest(e,h,c,g,b,d){b=b||{};var a=new Sys.Net.WebRequest;for(var f in c)a.get_headers()[f]=c[f];if(b){if(b.officeVersion)a.get_headers()[_officeVersionHeader]=b.officeVersion;if(b.correlationId)e+="&corr="+b.correlationId}d&&a.set_body(d);a.set_url(e);a.set_httpVerb(h);a.set_timeout(_defaultTimeout);a.set_userContext(b);a.add_completed(g);a.invoke()}function _onCompleted(a,g){var b=null,c=a.get_webRequest().get_userContext(),d=a.get_webRequest().get_url();if(a.get_timedOut()){Sys.Debug.trace("Request timed out: "+d);_invokeCallbackTag(c.callback,statusCode.Failed,b,b,a,6062418)}else if(a.get_aborted()){Sys.Debug.trace("Request aborted: "+d);_invokeCallbackTag(c.callback,statusCode.Failed,b,b,a,6062419)}else if(a.get_responseAvailable())if(a.get_statusCode()==200)try{c._onCompleteHandler(a,g)}catch(f){Sys.Debug.trace("Request failed with exception "+f+": "+d);_invokeCallbackTag(c.callback,statusCode.Failed,f,b,a,6062420)}else{var e=a.get_statusText();Sys.Debug.trace("Request failed with status code "+e+": "+d);_invokeCallbackTag(c.callback,statusCode.Failed,e,b,a,6062421)}else{Sys.Debug.trace("Request failed: "+d);_invokeCallbackTag(c.callback,statusCode.Failed,e,b,a,6062422)}}function _isProxyReady(b,a){a&&a({status:statusCode.Succeeded,result:true})}function _createQueryStringFragment(b){var c="";for(var d in b){var a=b[d];if(a===null||a===undefined||a==="")continue;c+="&"+encodeURIComponent(d)+"="+encodeURIComponent(a)}return c}OSF.SQMDataPoints={DATAID_APPSFOROFFICEUSAGE:10595,DATAID_APPSFOROFFICENOTIFICATIONS:10942};OSF.BWsaStreamTypes={Static:1};OSF.BWsaConfig={defaultMaxStreamRows:1e3};OSF.ErrorStatusCodes={E_OEM_EXTENSION_NOT_ENTITLED:2147758662,E_MANIFEST_SERVER_UNAVAILABLE:2147758672,E_USER_NOT_SIGNED_IN:2147758677,E_MANIFEST_DOES_NOT_EXIST:2147758673,E_OEM_EXTENSION_KILLED:2147758660,E_OEM_OMEX_EXTENSION_KILLED:2147758686,E_MANIFEST_UPDATE_AVAILABLE:2147758681,S_OEM_EXTENSION_TRIAL_MODE:275013,E_OEM_EXTENSION_WITHDRAWN_FROM_SALE:2147758690,E_TOKEN_EXPIRED:2147758675,E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED:2147757992,E_MANIFEST_REFERENCE_INVALID:2147758678,S_USER_CLICKED_BUY:274205,E_MANIFEST_INVALID_VALUE_FORMAT:2147758654,E_TRUSTCENTER_MOE_UNACTIVATED:2147757996,S_OEM_EXTENSION_FLAGGED:275040,S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE:275041,E_BROWSER_VERSION:2147758194,WAC_AgaveUnsupportedStoreType:1041,WAC_AgaveActivationError:1042,WAC_ActivateAttempLoading:1043,WAC_HTML5IframeSandboxNotSupport:1044,WAC_AgaveRequirementsErrorOmex:1045,WAC_AgaveRequirementsError:1046};OSF.InvokeResultCode={S_OK:0,E_REQUEST_TIME_OUT:-2147471590,E_USER_NOT_SIGNED_IN:-2147209457,E_CATALOG_ACCESS_DENIED:-2147471591,E_CATALOG_REQUEST_FAILED:-2147471589,E_OEM_NO_NETWORK_CONNECTION:-2147208640,E_PROVIDER_NOT_REGISTERED:-2147208617,E_OEM_CACHE_SHUTDOWN:-2147208637,E_OEM_REMOVED_FAILED:-2147209421,E_CATALOG_NO_APPS:-1,E_GENERIC_ERROR:-1e3,S_HIDE_PROVIDER:10};OSF.OmexClientNames=function(){var a={},b=OSF.AppName;a[b.ExcelWebApp]="WAC_Excel";a[b.WordWebApp]="WAC_Word";a[b.OutlookWebApp]="WAC_Outlook";a[b.AccessWebApp]="WAC_Access";a[b.PowerpointWebApp]="WAC_Powerpoint";return a}();OSF.OmexAppVersions=function(){var a={},b=OSF.AppName;a[b.ExcelWebApp]=OSF.AppVersion.excelwebapp;a[b.WordWebApp]=OSF.AppVersion.wordwebapp;a[b.OutlookWebApp]=OSF.AppVersion.outlookwebapp;a[b.AccessWebApp]=OSF.AppVersion.access;a[b.PowerpointWebApp]=OSF.AppVersion.powerpointwebapp;return a}();OSF.ManifestSchemaVersion={"1.0":"1.0","1.1":"1.1"};OSF.ManifestNamespaces={"1.0":'xmlns="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"',"1.1":'xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"'};OSF.RequirementsChecker=function(d,f,e,c,b){var a=this;a.setCapabilities(d);a.setHosts(f);a.setRequirements(e);a.setSupportedControlTargets(c);a.setSupportedOmexAppVersions(b);a.setFilteringEnabled(false)};OSF.RequirementsChecker.prototype={defaultMinMaxVersion:"1.1",isManifestSupported:function(a){if(!this.isFilteringEnabled())return true;if(!a)return false;var b=a.getManifestSchemaVersion()||OSF.ManifestSchemaVersion["1.0"];switch(b){case OSF.ManifestSchemaVersion["1.0"]:return this._checkManifest1_0(a);case OSF.ManifestSchemaVersion["1.1"]:return this._checkManifest1_1(a);default:return false}},isEntitlementFromOmexSupported:function(a){var c=this;if(!c.isFilteringEnabled())return true;if(!a)return false;var d;switch(a.appSubType){case "1":d=OSF.OsfControlTarget.TaskPane;break;case "2":d=OSF.OsfControlTarget.InContent;break;case "3":d=OSF.OsfControlTarget.Contextual;break;case "4":d=OSF.OsfControlTarget.TaskPane;break;default:return false}if(!c._checkControlTarget(d))return false;if(!a.requirements&&!a.hosts){if(!a.hasOwnProperty("appVersions"))return true;return c._checkOmexAppVersions(a.appVersions)}var b=new OSF.Manifest.Manifest(function(){}),e,f,h,g;if(a.requirements){b._xmlProcessor=new OSF.XmlProcessor(a.requirements,OSF.ManifestNamespaces["1.1"]);f=b._xmlProcessor.getDocumentElement()}e=b._parseRequirements(f);if(a.hosts){b._xmlProcessor=new OSF.XmlProcessor(a.hosts,OSF.ManifestNamespaces["1.1"]);g=b._xmlProcessor.getDocumentElement()}h=b._parseHosts(g);return c._checkHosts(h)&&c._checkSets(e.sets)&&c._checkMethods(e.methods)},isEntitlementFromCorpCatalogSupported:function(c){var a=this;if(!a.isFilteringEnabled())return true;if(!c)return false;var i=OSF.OfficeAppType[c.OEType];if(!a._checkControlTarget(i))return false;var b=new OSF.Manifest.Manifest(function(){}),g,h,f;if(c.OfficeExtensionCapabilitiesXML){b._xmlProcessor=new OSF.XmlProcessor(c.OfficeExtensionCapabilitiesXML,OSF.ManifestNamespaces["1.1"]);var e,d;e=b._xmlProcessor.getDocumentElement();d=b._parseRequirements(e);h=d.sets;f=d.methods;g=b._parseHosts(e)}return a._checkHosts(g)&&a._checkSets(h)&&a._checkMethods(f)},setCapabilities:function(a){this._supportedCapabilities=this._scalarArrayToObject(a)},setHosts:function(a){this._supportedHosts=this._scalarArrayToObject(a)},setRequirements:function(a){var b=this;b._supportedSets=a&&b._arrayToSetsObject(a.sets)||{};b._supportedMethods=a&&b._scalarArrayToObject(a.methods)||{}},setSupportedControlTargets:function(a){this._supportedControlTargets=this._scalarArrayToObject(a)},setSupportedOmexAppVersions:function(a){this._supportedOmexAppVersions=a&&a.slice?a.slice(0):[]},setFilteringEnabled:function(a){this._filteringEnabled=a?true:false},isFilteringEnabled:function(){return this._filteringEnabled},_checkManifest1_0:function(a){return this._checkCapabilities(a.getCapabilities())},_checkCapabilities:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(this._supportedCapabilities[a[b]])return true;return false},_checkManifest1_1:function(b){var a=b.getRequirements()||{};return this._checkHosts(b.getHosts())&&this._checkSets(a.sets)&&this._checkMethods(a.methods)},_checkHosts:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(this._supportedHosts[a[b]])return true;return false},_checkSets:function(b){var a=this;if(!b||b.length===0)return true;for(var e=0;e<b.length;e++){var c=b[e],d=a._supportedSets[c.name];if(!d)return false;if(c.version)if(a._compareVersionStrings(d.minVersion||a.defaultMinMaxVersion,c.version)>0||a._compareVersionStrings(d.maxVersion||a.defaultMinMaxVersion,c.version)<0)return false}return true},_checkMethods:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(!this._supportedMethods[a[b]])return false;return true},_checkControlTarget:function(a){return a!=undefined&&this._supportedControlTargets[a]},_checkOmexAppVersions:function(b){if(!b)return false;for(var a=0;a<this._supportedOmexAppVersions.length;a++)if(b.indexOf(this._supportedOmexAppVersions[a])>=0)return true;return false},_scalarArrayToObject:function(a){var c={};if(a&&a.length)for(var b=0;b<a.length;b++)if(a[b]!=undefined)c[a[b]]=true;return c},_arrayToSetsObject:function(a){var d={};if(a&&a.length)for(var c=0;c<a.length;c++){var b=a[c];if(b&&b.name!=undefined)d[b.name]=b}return d},_compareVersionStrings:function(b,a){b=b.split(".");a=a.split(".");for(var f=Math.max(b.length,a.length),c=0;c<f;c++){var e=parseInt(b[c],10)||0,d=parseInt(a[c],10)||0;if(e===d)continue;return e-d}return 0}};var _omexDataProvider=OmexDataProvider.GetInstance(new AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new SafeSerializer));OSF.OsfControl=function(b){var d=null,e=true,c=false,a=this;OSF.OUtil.validateParamObject(b,{div:{type:Object,mayBeNull:c},contextActivationMgr:{type:Object,mayBeNull:c},id:{type:String,mayBeNull:c},marketplaceID:{type:String,mayBeNull:c},marketplaceVersion:{type:String,mayBeNull:c},store:{type:String,mayBeNull:c},storeType:{type:String,mayBeNull:c},alternateReference:{type:Object,mayBeNull:e},settings:{type:Object,mayBeNull:e},reason:{type:String,mayBeNull:e},osfControlType:{type:Number,mayBeNull:e},snapshotUrl:{type:String,mayBeNull:e},preactivationCallback:{type:Object,mayBeNull:e}},d);a._div=b.div;a._contextActivationMgr=b.contextActivationMgr;a._id=b.id;a._storeType=b.storeType.toLowerCase();a._storeLocator=b.store;a._marketplaceID=b.marketplaceID;a._marketplaceVersion=b.marketplaceVersion;a._alternateReference=b.alternateReference;a._settings=b.settings||{};a._reason=b.reason==undefined?Microsoft.Office.WebExtension.InitializationReason.DocumentOpened:b.reason;a._osfControlType=b.osfControlType==undefined?OSF.OsfControlType.DocumentLevel:b.osfControlType;a._snapshotUrl=b.snapshotUrl;a._status=OSF.OsfControlStatus.NotActivated;a._iframeUrl=d;a._permission=d;a._conversationId=d;a._manifestUrl=d;a._pageIsReady=c;a._pageIsReadyTimerExpired=c;a._timer=d;a._retryLoadingNum=2;a._frame=d;a._agaveEndPoint=d;a._etoken="";a._sqmDWords=[0,0];a._preactivationCallback=b.preactivationCallback;a._telemetryContext={};a._controlFocus=c;if(OSF.OUtil.isiOS()){a._div.style.webkitOverflowScrolling="touch";a._div.style.overflow="auto"}a._appCorrelationId=OSF.OUtil.Guid.generateNewGuid();a._iframeOnLoadDelegate=Function.createDelegate(a,a._iframeOnLoad);a._retryActivate=d};OSF.OsfControl.prototype={activate:function(d){var f=true,c=null,h=false,a=this;try{Telemetry.AppLoadTimeHelper.ActivationStart(a._telemetryContext,a._sqmDWords[0],a._sqmDWords[1],a._appCorrelationId,a._id);a._controlFocus=h;OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.ActivationStart);if(a._status!==OSF.OsfControlStatus.Activated){if(a._frame){OSF.OUtil.removeEventListener(a._frame,"load",a._iframeOnLoadDelegate);a._frame=c}while(a._div.childNodes.length>0)a._div.removeChild(a._div.childNodes.item(0));a._contextActivationMgr._ErrorUXHelper.showProgress(a._div,a._id);a._contextActivationMgr.registerOsfControl(a);if(!a._doesBrowserSupportRequiredFeatures()){a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnsupportedBroswer_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),c,c,c,f,OSF.ErrorStatusCodes.E_BROWSER_VERSION);a.invokePreactivationCompletedCallback();return}var o=document.createElement("iframe"),q="sandbox" in o;o=c;var m=h,l=OSF.OUtil.getLocalStorage();if(l)m=l.getItem(OSF.Constants.IgnoreSandBoxSupport);if(a._contextActivationMgr._autoTrusted&&!q&&!m){a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);a._status=OSF.OsfControlStatus.NotSandBoxSupported;a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AppsDisabled_WRN,description:Strings.OsfRuntime.L_NotSandBoxSupported_ERR,buttonTxt:Strings.OsfRuntime.L_EnableAppsButton_TXT,buttonCallback:Function.createCallback(a._activateAgavesBlockedBySandboxNotSupport,a._contextActivationMgr),url:OSF.Constants.IEUpgradeUrl,urlButtonTxt:Strings.OsfRuntime.L_UpgradeBrowserButton_TXT,dismissCallback:c,reDisplay:f,displayDeactive:f,errorCode:OSF.ErrorStatusCodes.WAC_HTML5IframeSandboxNotSupport,highPriority:f});a.invokePreactivationCompletedCallback();return}d=d||{};d.hostType=a._contextActivationMgr._hostType;d.osfControl=d.osfControl||a;d.referenceInUse=d.referenceInUse||{id:a._marketplaceID,version:a._marketplaceVersion,storeType:a._storeType,storeLocator:a._storeLocator};d.correlationId=d.osfControl._appCorrelationId;var b=a;Telemetry.AppLoadTimeHelper.ServerCallStart(a._telemetryContext);var e=d.referenceInUse;if(e.storeType===OSF.StoreType.Exchange)OSF.OsfManifestManager.getManifestAsync(d,Function.createDelegate(a,a._onGetManifestCompleted));else if(e.storeType===OSF.StoreType.SPCatalog)if(a._contextActivationMgr._doesUrlHaveSupportedProtocol(e.storeLocator)){Telemetry.AppLoadTimeHelper.EntitlementCheckStart(a._telemetryContext);d.webUrl=e.storeLocator;OSF.OUtil.writeProfilerMark(OSF.OsfOfficeExtensionManagerPerfMarker.GetEntitlementStart);OSF.OsfManifestManager.getCorporateCatalogEntitlementsAsync(d,Function.createDelegate(a,a._onGetEntitlementsCompleted))}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnknownStoreType_ERR,c,c,c,c,c,c,OSF.ErrorStatusCodes.E_MANIFEST_REFERENCE_INVALID);else if(e.storeType===OSF.StoreType.SPApp){Telemetry.AppLoadTimeHelper.EntitlementCheckStart(a._telemetryContext);d.baseUrl=a._contextActivationMgr.getPageBaseUrl();d.pageUrl=a._contextActivationMgr._docUrl;d.webUrl=a._contextActivationMgr._webUrl;d.appWebUrl=a._contextActivationMgr._webUrl;OSF.OsfManifestManager.getSPAppEntitlementsAsync(d,Function.createDelegate(a,a._onGetEntitlementsCompleted))}else if(e.storeType===OSF.StoreType.OMEX)if(a._contextActivationMgr.isExternalMarketplaceAllowed()&&a._contextActivationMgr._doesUrlHaveSupportedProtocol(a._contextActivationMgr._osfOmexBaseUrl)){if(!a._omexEntitlement){a._omexEntitlement={contentMarket:e.storeLocator,version:e.version,assetId:e.id,etoken:"",hasEntitlement:h};a._omexEntitlement.endPointUrl=a._contextActivationMgr._getOmexEndPointPageUrl(e.id,e.storeLocator)}d.clientVersion=a._contextActivationMgr._getClientVersionForOmex();if(d.clientVersion){d.clientName=a._contextActivationMgr._getClientNameForOmex();d.appVersion=a._contextActivationMgr._getAppVersionForOmex()}var p=function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){var c=parseInt(a.value);if(c==OSF.OmexAuthNStatus.Authenticated){b._contextActivationMgr._omexAuthNStatus=OSF.OmexAuthNStatus.Authenticated;b._contextActivationMgr._createOmexProxy(b._contextActivationMgr._omexGatedWSProxy,i)}else if(c==OSF.OmexAuthNStatus.Anonymous||c==OSF.OmexAuthNStatus.Unknown){b._contextActivationMgr._omexAuthNStatus=OSF.OmexAuthNStatus.Anonymous;b._contextActivationMgr._createOmexProxy(b._contextActivationMgr._omexAnonymousWSProxy,g)}}else{b._contextActivationMgr._omexAuthNStatus=OSF.OmexAuthNStatus.CheckFailed;if(b._contextActivationMgr._omexForceAnonymous)b._contextActivationMgr._createOmexProxy(b._contextActivationMgr._omexAnonymousWSProxy,g);else b._contextActivationMgr._createOmexProxy(b._contextActivationMgr._omexGatedWSProxy,i)}},j=1,g=function(a){if(a)if(b._contextActivationMgr._omexAuthNStatus==OSF.OmexAuthNStatus.NotAttempted){var e={clientEndPoint:c};e.clientEndPoint=a;OSF.OsfManifestManager._invokeProxyMethodAsync(d,"OMEX_getAuthNStatus",p,e)}else{Telemetry.AppLoadTimeHelper.AuthenticationEnd(b._telemetryContext);Telemetry.AppLoadTimeHelper.KilledAppsCheckStart(b._telemetryContext);if(b._contextActivationMgr._omexAuthNStatus==OSF.OmexAuthNStatus.CheckFailed)b._contextActivationMgr._omexForceAnonymous=f;d.anonymous=f;Telemetry.AppLoadTimeHelper.SetAnonymousFlag(b._telemetryContext,d.anonymous);d.clientEndPoint=a;OSF.OsfManifestManager.getOmexKilledAppsAsync(d,Function.createDelegate(b,b._onGetOmexKilledAppsCompleted));Telemetry.AppLoadTimeHelper.AppStateCheckStart(b._telemetryContext);OSF.OsfManifestManager.getOmexAppStateAsync(d,Function.createDelegate(b,b._onGetOmexAppStateCompleted))}else b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),c,c,c,c,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)};Telemetry.AppLoadTimeHelper.AuthenticationStart(a._telemetryContext);var i=function(a){Telemetry.AppLoadTimeHelper.SetRetryCount(b._telemetryContext,j);if(a){Telemetry.AppLoadTimeHelper.AuthenticationEnd(b._telemetryContext);Telemetry.AppLoadTimeHelper.EntitlementCheckStart(b._telemetryContext);d.anonymous=h;Telemetry.AppLoadTimeHelper.SetAnonymousFlag(b._telemetryContext,d.anonymous);d.clientEndPoint=a;OSF.OsfManifestManager.getOmexEntitlementsAsync(d,Function.createDelegate(b,b._onGetOmexEntitlementsCompleted));Telemetry.AppLoadTimeHelper.KilledAppsCheckStart(b._telemetryContext);OSF.OsfManifestManager.getOmexKilledAppsAsync(d,Function.createDelegate(b,b._onGetOmexKilledAppsCompleted))}else if(j<OSF.Constants.AuthenticatedConnectMaxTries){j++;if(b._contextActivationMgr._omexAuthNStatus==OSF.OmexAuthNStatus.CheckFailed)b._contextActivationMgr._createOmexProxy(b._contextActivationMgr._omexGatedWSProxy,i);else b._contextActivationMgr._createOmexProxy(b._contextActivationMgr._omexAnonymousWSProxy,g)}else b._contextActivationMgr._createOmexProxy(b._contextActivationMgr._omexAnonymousWSProxy,g)},n=f,r={contentMarket:e.storeLocator,assetID:e.id};if(_omexDataProvider.AllCached(d,r))try{Telemetry.AppLoadTimeHelper.AuthenticationEnd(b._telemetryContext);d.anonymous=f;d.clientEndPoint={};Telemetry.AppLoadTimeHelper.KilledAppsCheckStart(b._telemetryContext);OSF.OsfManifestManager.getOmexKilledAppsAsync(d,Function.createDelegate(b,b._onGetOmexKilledAppsCompleted));Telemetry.AppLoadTimeHelper.AppStateCheckStart(b._telemetryContext);OSF.OsfManifestManager.getOmexAppStateAsync(d,Function.createDelegate(b,b._onGetOmexAppStateCompleted));n=h}catch(s){}if(n)if(a._contextActivationMgr._omexAuthNStatus==OSF.OmexAuthNStatus.CheckFailed)if(a._contextActivationMgr._omexForceAnonymous)a._contextActivationMgr._createOmexProxy(a._contextActivationMgr._omexAnonymousWSProxy,g);else a._contextActivationMgr._createOmexProxy(a._contextActivationMgr._omexGatedWSProxy,i);else if(a._contextActivationMgr._omexForceAnonymous)a._contextActivationMgr._createOmexProxy(a._contextActivationMgr._omexAnonymousWSProxy,g);else{a._contextActivationMgr._omexAuthNStatus=OSF.OmexAuthNStatus.NotAttempted;a._contextActivationMgr._createOmexProxy(a._contextActivationMgr._omexGatedWSProxy,i)}}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR,c,c,c,c,c,c,OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED);else if(e.storeType===OSF.StoreType.FileSystem||e.storeType===OSF.StoreType.Registry)a._showActivationWarning(OSF.OsfControlStatus.UnsupportedStore,Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,c,c,c,c,OSF.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType);else a._showActivationError(OSF.OsfControlStatus.UnknownStore,Strings.OsfRuntime.L_AgaveUnknownStoreType_ERR,c,c,c,c,c,c,OSF.ErrorStatusCodes.E_MANIFEST_REFERENCE_INVALID)}}catch(k){Sys.Debug.trace("Error getting app data: "+k);Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error getting app data.",k,a._appCorrelationId,6062160);a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),c,c,c,c,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)}a.invokePreactivationCompletedCallback()},deActivate:function(){var b=null,a=this;try{OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.DeactivationStart);a._contextActivationMgr.dismissMessages(a._id);a._retryActivate=b;if(a._status!==OSF.OsfControlStatus.NotActivated){if(a._agaveEndPoint){Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(a._agaveEndPoint._conversationId);a._agaveEndPoint=b}if(a._frame){OSF.OUtil.removeEventListener(a._frame,"load",a._iframeOnLoadDelegate);a._frame=b}if(a._timer){window.clearTimeout(a._timer);a._timer=b}while(a._div.childNodes.length>0)a._div.removeChild(a._div.childNodes.item(0));a._status=OSF.OsfControlStatus.NotActivated;a._conversationId&&a._contextActivationMgr._getServiceEndPoint().unregisterConversation(a._conversationId);a._contextActivationMgr.raiseOsfControlStatusChange(a)}a._controlFocus=false;OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.DeactivationEnd)}catch(c){Sys.Debug.trace("Deactivate failed: "+c);Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Deactivate failed.",c,a._appCorrelationId,6062161)}},purge:function(d){var a=this,c=Function._validateParams(arguments,[{name:"purgeManifest",type:Boolean,mayBeNull:false}]);if(c)throw c;try{a._contextActivationMgr._ErrorUXHelper.purgeOsfControlNotification(a._id);a.deActivate();d&&OSF.OsfManifestManager.purgeManifest(a._marketplaceID,a._marketplaceVersion);a._contextActivationMgr.unregisterOsfControl(a)}catch(b){Sys.Debug.trace("Purge failed: "+b);Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Purge failed.",b,a._appCorrelationId,6062162)}},invokePreactivationCompletedCallback:function(){this._preactivationCallback&&this._preactivationCallback()},getMarketplaceID:function(){return this._marketplaceID},getMarketplaceVersion:function(){return this._marketplaceVersion},getContainingDiv:function(){return this._div},getID:function(){return this._id},getSettings:function(){return this._settings},setSettings:function(a){this._settings=a},getReason:function(){return this._reason},getOsfControlType:function(){return this._osfControlType},getSnapshotUrl:function(){return this._snapshotUrl},getStoreType:function(){return this._storeType},getStoreLocator:function(){return this._storeLocator},getProperty:function(b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false}]);if(a)throw a;return this._settings[b]},addProperty:function(c,b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false},{name:"value",type:String,mayBeNull:false}]);if(a)throw a;this._settings[c]=b},removeProperty:function(b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false}]);if(a)throw a;delete this._settings[b]},getStatus:function(){return this._status},getIframeUrl:function(){return this._iframeUrl},getPermission:function(){return this._permission},getTrustNoPrompt:function(){return false},getEToken:function(){return this._omexEntitlement?this._omexEntitlement.etoken:this._etoken},notifyAgave:function(a){this._agaveEndPoint&&this._agaveEndPoint.invoke("Office_notifyAgave",null,a)},_onGetEntitlementsCompleted:function(b){var a=null,d=this;b.context&&b.context.referenceInUse.storeType===OSF.StoreType.SPCatalog&&OSF.OUtil.writeProfilerMark(OSF.OsfOfficeExtensionManagerPerfMarker.GetEntitlementEnd);if(b.statusCode===OSF.ProxyCallStatusCode.Succeeded&&b.value){Telemetry.AppLoadTimeHelper.EntitlementCheckEnd(d._telemetryContext);for(var h=b.context.referenceInUse,g=b.value.entitlements,i=g.length,c,e=a,f=0;f<i;f++){c=g[f];if(c.OfficeExtensionID&&h.id&&c.OfficeExtensionID.toLowerCase()===h.id.toLowerCase())if(!e||d._lessThan(e.OfficeExtensionVersion,c.OfficeExtensionVersion))e=c}c=e;if(!c)d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotExist_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createCallback(function(a){a.osfControl._refresh(a)},{clearCache:true,referenceInUse:b.context.referenceInUse,osfControl:b.context.osfControl}),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST);else if(c.OfficeExtensionKillbit)d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,a,a,a,a,a,a,OSF.ErrorStatusCodes.E_OEM_EXTENSION_KILLED);else{b.context.manifestUrl=c.EncodedAbsUrl;b.context.appInstanceId=c.AppInstanceID;b.context.productId=c.ProductID;if(b.context.appInstanceId)OSF.OsfManifestManager.getAppInstanceInfoByIdAsync(b.context,Function.createDelegate(d,d._onGetAppInstanceInfoByIdCompleted));else OSF.OsfManifestManager.getManifestAsync(b.context,Function.createDelegate(d,d._onGetManifestCompleted))}}else d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(d,d._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetAppInstanceInfoByIdCompleted:function(e){var d=null,b=this;if(e.statusCode===OSF.ProxyCallStatusCode.Succeeded&&e.value){var c=e.value,a=e.context;if(c.AppWebFullUrl)a.appWebUrl=c.AppWebFullUrl;a.clientId=c.AppPrincipalId;a.remoteAppUrl=c.RemoteAppUrl;if(a.appWebUrl&&a.productId)OSF.OsfManifestManager.getSPTokenByProductIdAsync(a,Function.createDelegate(b,b._onGetSPTokenByProductIdCompleted));else OSF.OsfManifestManager.getManifestAsync(a,Function.createDelegate(b,b._onGetManifestCompleted))}else b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),d,d,d,d,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetSPTokenByProductIdCompleted:function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value)this._etoken=a.value;OSF.OsfManifestManager.getManifestAsync(a.context,Function.createDelegate(this,this._onGetManifestCompleted))},_onGetOmexEntitlementsCompleted:function(b){var d=null,a=this;if(b.statusCode===OSF.ProxyCallStatusCode.Succeeded&&b.value){Telemetry.AppLoadTimeHelper.EntitlementCheckEnd(a._telemetryContext);var g=b.context.referenceInUse,f=b.value.entitlements,i=f.length,c,h=false;a._contextActivationMgr._omexBillingMarket=b.value.billingMarket;_omexDataProvider.SetCustomerId(b.value.cid);for(var e=0;e<i;e++){c=f[e];if(c.assetId&&g.id&&c.assetId.toLowerCase()===g.id.toLowerCase()){h=true;break}}if(h){a._omexEntitlement.hasEntitlement=true;a._omexEntitlement.productId=c.productId;a._omexEntitlement.version=c.version;a._omexEntitlement.contentMarket=c.contentMarket;a._omexEntitlement.licenseType=c.licenseType;a._omexEntitlement.endPointUrl=a._contextActivationMgr._getOmexEndPointPageUrl(a._omexEntitlement.assetId,a._omexEntitlement.contentMarket)}Telemetry.AppLoadTimeHelper.SetOmexHasEntitlementFlag(a._telemetryContext,a._omexEntitlement.hasEntitlement);Telemetry.AppLoadTimeHelper.AppStateCheckStart(a._telemetryContext);OSF.OsfManifestManager.getOmexAppStateAsync(b.context,Function.createDelegate(a,a._onGetOmexAppStateCompleted))}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),d,d,d,d,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetOmexKilledAppsCompleted:function(a){var b=null,c=this;if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){Telemetry.AppLoadTimeHelper.KilledAppsCheckEnd(c._telemetryContext);!a.cached&&_omexDataProvider.SetKilledAppsCache(a.context,a.value);for(var e=a.value.killedApps,g=e.length,f=false,d=0;d<g;d++)if(e[d].assetId===c._marketplaceID){f=true;break}if(f){c._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,b,b,c._omexEntitlement.endPointUrl,b,b,b,OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED);return}}},_onGetOmexAppStateCompleted:function(d){var f=true,c=null,a=this;if(d.statusCode===OSF.ProxyCallStatusCode.Succeeded&&d.value){Telemetry.AppLoadTimeHelper.AppStateCheckEnd(a._telemetryContext);Telemetry.AppLoadTimeHelper.SetAppStateDataCachedFlag(a._telemetryContext,d.cached);var b=d.context,g=d.value,h=parseInt(g.state);if(h===OSF.OmexState.Killed){a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,c,c,a._omexEntitlement.endPointUrl,c,c,c,OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED);return}else if(h===OSF.OmexState.Flagged)b.showSoftKilled=f;else if(h===OSF.OmexState.DeveloperWithdrawn)b.showDeveloperWithDrawWarning=f;if(!a._omexEntitlement.hasEntitlement&&(b.showDeveloperWithDrawWarning||b.showSoftKilled)){a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveRetired_ERR,c,c,a._omexEntitlement.endPointUrl,c,c,c,OSF.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE);if(b.showSoftKilled)return}a._omexEntitlement.latestVersion=g.version;if(a._omexEntitlement.hasEntitlement&&a._lessThan(a._omexEntitlement.version,a._omexEntitlement.latestVersion)){b.showNewerVersion=f;b.expectedVersion=a._omexEntitlement.latestVersion}!d.cached&&_omexDataProvider.SetAppStateCache(b,g);if(!b.anonymous&&!a._omexEntitlement.hasEntitlement){var e=a,i=function(){b.anonymous=f;b.clientEndPoint=e._contextActivationMgr._omexAnonymousWSProxy.clientEndPoint;Telemetry.AppLoadTimeHelper.ManifestRequestStart(e._telemetryContext);OSF.OsfManifestManager.getOmexManifestAndETokenAsync(b,Function.createDelegate(e,e._onGetOmexManifestAndETokenCompleted))};e._contextActivationMgr._createOmexProxy(e._contextActivationMgr._omexAnonymousWSProxy,i);return}}Telemetry.AppLoadTimeHelper.ManifestRequestStart(a._telemetryContext);OSF.OsfManifestManager.getOmexManifestAndETokenAsync(d.context,Function.createDelegate(a,a._onGetOmexManifestAndETokenCompleted))},_onGetOmexManifestAndETokenCompleted:function(g){var a=null,c=true,b=this;if(g.statusCode===OSF.ProxyCallStatusCode.Succeeded&&g.value){var f=g.value,e=parseInt(f.status),d=g.context,h=d.referenceInUse;Telemetry.AppLoadTimeHelper.SetManifestDataCachedFlag(b._telemetryContext,g.cached);if(e===OSF.OmexClientAppStatus.OK){if(d.acceptedUpgrade){b._refresh({clearEntitlement:c,clearAppState:c,referenceInUse:h,osfControl:b});return}if(f.tokenExpirationDate&&new Date(f.tokenExpirationDate)<=new Date){b._showActivationWarning(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,OSF.ErrorStatusCodes.E_TOKEN_EXPIRED);return}b._omexEntitlement.etoken=f.etoken;b._omexEntitlement.entitlementType=f.entitlementType;if(!d.anonymous&&b._omexEntitlement.entitlementType&&b._omexEntitlement.entitlementType.toLowerCase()===OSF.OmexEntitlementType.Trial)d.showTrialInfo=c;try{!g.cached&&_omexDataProvider.SetManifestAndETokenCache(d,f);var i=new OSF.Manifest.Manifest(f.manifest,b._contextActivationMgr.getAppUILocale());d.manifestCached=f.cached;OSF.OsfManifestManager.cacheManifest(h.id,h.version,i);if(b._omexEntitlement.latestVersion&&b._lessThan(i.getMarketplaceVersion(),b._omexEntitlement.latestVersion)){d.showNewerVersion=c;d.expectedVersion=b._omexEntitlement.latestVersion}b._onGetManifestCompleted({statusCode:OSF.ProxyCallStatusCode.Succeeded,value:i,context:d})}catch(j){Sys.Debug.trace("Invalid manifest from marketplace: "+j);Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid manifest from marketplace.",j,b._appCorrelationId,6062163);b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE);return}}else if(e===OSF.OmexClientAppStatus.KilledAsset)b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,a,a,b._omexEntitlement.endPointUrl,a,a,a,OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED);else if(e===OSF.OmexClientAppStatus.NoEntitlement||e===OSF.OmexClientAppStatus.TrialNotSupported||e===OSF.OmexClientAppStatus.LimitedTrial||e===OSF.OmexClientAppStatus.EntitlementDeactivated)if(!d.anonymous){var k=function(b){var a=b.osfControl;a._refresh({clearCache:c,referenceInUse:b.referenceInUse,osfControl:a})},m=function(d){var b=d.osfControl;window.open(b._omexEntitlement.endPointUrl);b._contextActivationMgr.displayNotification({id:b._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveLicenseNotAquiredRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:Function.createCallback(k,d),url:a,dismissCallback:a,detailView:c,reDisplay:c,displayDeactive:c,retryAll:c,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})};b._retryActivate=Function.createCallback(k,d);b._showActivationWarning(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveLicenseNotAquired_ERR,Strings.OsfRuntime.L_BuyButton_TXT,Function.createCallback(m,d),a,a,OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED)}else{var n=function(d){var b=d.osfControl,c=window.location.href,a=b._contextActivationMgr._osfOmexBaseUrl+OSF.Constants.SignInRedirectUrl+encodeURIComponent(c);window.open(a)};b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotViewableAnonymous_ERR,Strings.OsfRuntime.L_SignInButton_TXT,Function.createCallback(n,d),a,a,Strings.OsfRuntime.L_AgaveSigninRequiredTitle_TXT,a,OSF.ErrorStatusCodes.E_USER_NOT_SIGNED_IN)}else if(e===OSF.OmexClientAppStatus.UnknownAssetId)b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotExist_ERR,a,a,a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST);else if(e===OSF.OmexClientAppStatus.Expired||e===OSF.OmexClientAppStatus.Invalid)b._showActivationWarning(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,OSF.ErrorStatusCodes.E_TOKEN_EXPIRED);else if(e===OSF.OmexClientAppStatus.Revoked)b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveRetired_ERR,a,a,b._omexEntitlement.endPointUrl,a,a,a,OSF.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE);else if(e===OSF.OmexClientAppStatus.VersionMismatch){var l=function(b){var a=b.osfControl;a._refresh({clearManifest:c,clearToken:c,referenceInUse:b.referenceInUse,osfControl:a,acceptedUpgrade:c,expectedVersion:f.version})};b._contextActivationMgr.displayNotification({id:b._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,buttonCallback:Function.createCallback(l,d),url:b._omexEntitlement.endPointUrl,dismissCallback:a,detailView:false,reDisplay:c,highPriority:c,displayDeactive:c,logAsError:c,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE})}else if(e===OSF.OmexClientAppStatus.VersionNotSupported)b._showActivationWarning(OSF.OsfControlStatus.UnsupportedStore,Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,a,a,a,a,OSF.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType);else b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)}else b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_retryActivation:function(){var a=this;a._retryLoadingNum--;if(a._pageIsReady||a._retryLoadingNum<=0){a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);a._retryLoadingNum=2}else a._refresh()},_iframeOnLoad:function(){var a=this;Telemetry.AppLoadTimeHelper.PageLoaded(this._telemetryContext);var b=function(b){var a=null;if(b){if(b._contextActivationMgr._ErrorUXHelper){OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.SelectionTimeout);b._contextActivationMgr._ErrorUXHelper.removeProgressDiv(b._div,b._id)}if(!b._pageIsReady)if(b._retryLoadingNum===2)b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveActivationError_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._retryActivation),a,a,a,a,OSF.ErrorStatusCodes.WAC_AgaveActivationError);else b._retryLoadingNum===1&&b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_ActivateAttempLoading_ERR,Strings.OsfRuntime.L_ActivateButton_TXT,Function.createDelegate(b,b._retryActivation),a,a,a,a,OSF.ErrorStatusCodes.WAC_ActivateAttempLoading);if(b._timer){window.clearTimeout(b._timer);b._timer=a}b._pageIsReadyTimerExpired=true}};if(!a._pageIsReady)a._timer=window.setTimeout(function(){b(a)},5e3*a._retryLoadingNum+1)},_isOsfControlInEmbeddingMode:function(e){var a=false;try{var d=e.getContainingDiv().parentNode.parentNode,c=d.id,f=c.match(/^(m_excelEmbedRenderer_|ewaSynd).+$/ig);a=f!=null}catch(b){Sys.Debug.trace("_isOsfControlInEmbeddingMode error: "+b)}return a},_createIframeAndActivateOsfControl:function(c){var b=this,a=document.createElement("iframe");a.setAttribute("id",b._id);a.setAttribute("width","100%");a.setAttribute("height","100%");a.setAttribute("frameborder","0");var e=c?c:Strings.OsfRuntime.L_IframeTitle_TXT;a.setAttribute("title",e);a.style.msUserSelect="element";a.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin ms-allow-popups allow-popups");for(var d in b._contextActivationMgr._iframeAttributeBag)a.setAttribute(d,b._contextActivationMgr._iframeAttributeBag[d]);b._activate(a,b._iframeUrl);b._frame=a},_onGetManifestCompleted:function(i){var b=null,e=false,d=true,a=this;if(i.statusCode===OSF.ProxyCallStatusCode.Succeeded&&i.value){Telemetry.AppLoadTimeHelper.ManifestRequestEnd(a._telemetryContext);Telemetry.AppLoadTimeHelper.ServerCallEnd(a._telemetryContext);var g=i.value,c=i.context,j=c.referenceInUse,f=j.storeType,k=g.getDefaultDisplayName();if(c.manifestCached&&!c.retried){var q=g.getMarketplaceVersion();if(a._lessThan(q,j.version))if(f===OSF.StoreType.SPApp||f===OSF.StoreType.SPCatalog){a._refresh({clearCache:d,referenceInUse:j,osfControl:c.osfControl,retried:d});return}else if(f===OSF.StoreType.OMEX&&!c.showNewerVersion){c.showNewerVersion=d;c.expectedVersion=j.version}}if(g.requirementsSupported===e||g.requirementsSupported===undefined&&!a._contextActivationMgr.getRequirementsChecker().isManifestSupported(g)){g.requirementsSupported=e;var m,l,n=b;if(f===OSF.StoreType.OMEX){m=Strings.OsfRuntime.L_AgaveManifestRequirementsErrorOmex_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR;l=OSF.ErrorStatusCodes.WAC_AgaveRequirementsErrorOmex;n=a._omexEntitlement.endPointUrl}else{m=Strings.OsfRuntime.L_AgaveManifestRequirementsError_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR;l=OSF.ErrorStatusCodes.WAC_AgaveRequirementsError}a._showActivationError(OSF.OsfControlStatus.ActivationFailed,m,b,b,n,b,b,d,l);return}g.requirementsSupported=d;a._iframeUrl=g.getDefaultSourceLocation(a._contextActivationMgr.getFormFactor());a._permission=g.getPermission();if((f===OSF.StoreType.SPApp||f===OSF.StoreType.SPCatalog)&&a._iframeUrl){if(c.clientId)a._iframeUrl=a._iframeUrl.replace(/~clientid/ig,c.clientId);if(c.appWebUrl)a._iframeUrl=a._iframeUrl.replace(/~appweburl/ig,c.appWebUrl);if(c.remoteAppUrl)a._iframeUrl=a._iframeUrl.replace(/~remoteappurl/ig,c.remoteAppUrl)}if(!a._contextActivationMgr._doesUrlHaveSupportedProtocol(a._iframeUrl)){a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestError_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT);return}if((!c.anonymous||!a._isOsfControlInEmbeddingMode(c.osfControl))&&f!=OSF.StoreType.SPApp&&f!=OSF.StoreType.Exchange){var h=e,t=a._reason==Microsoft.Office.WebExtension.InitializationReason.Inserted||a._contextActivationMgr._autoTrusted||e;c.cacheKey=OSF.OUtil.formatString(OSF.Constants.ActivatedCacheKey,c.referenceInUse.id.toLowerCase(),c.referenceInUse.storeType,c.referenceInUse.storeLocator);h=a._getCachedFlag(c.cacheKey);if(f==OSF.StoreType.OMEX&&_omexDataProvider.GetCustomerId()!="0")h=a._omexEntitlement&&a._omexEntitlement.hasEntitlement;Telemetry.AppLoadTimeHelper.SetManifestTrustCachedFlag(a._telemetryContext,h);if(!h&&!t&&!a.getTrustNoPrompt()){OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.ActivationEnd);var s=function(c){var a=c.osfControl;a._setCachedFlag(c.cacheKey);Telemetry.AppLoadTimeHelper.ActivationStart(a._telemetryContext,a._sqmDWords[0],a._sqmDWords[1],a._appCorrelationId,a._id);if(f==OSF.StoreType.OMEX&&_omexDataProvider.GetCustomerId()!="0"){c.anonymous=e;c.clientEndPoint=a._contextActivationMgr._omexGatedWSProxy.clientEndPoint;var g=function(c){if(c.statusCode===OSF.ProxyCallStatusCode.Succeeded&&c.value){var e=c.value,f=parseInt(e.status),g=c.context;if(f===OSF.OmexClientAppStatus.OK){!c.cached&&_omexDataProvider.SetManifestAndETokenCache(g,e);a._refresh({clearEntitlement:d,osfControl:a});return}}a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)};OSF.OsfManifestManager.getOmexManifestAndETokenAsync(c,Function.createDelegate(a,g))}else{Telemetry.AppLoadTimeHelper.SetAnonymousFlag(a._telemetryContext,c.anonymous);a._createIframeAndActivateOsfControl(k)}};a._showTrustError(k,g.getProviderName(),f,Function.createCallback(s,c));return}if(a._reason==Microsoft.Office.WebExtension.InitializationReason.Inserted){a._contextActivationMgr._setCachedFlag(c.cacheKey);c.osfControl._retryActivate=b;a._contextActivationMgr.retryAll(c.osfControl._marketplaceID)}}if(c.showNewerVersion){var r=function(a){var b=a.osfControl;b._refresh({clearManifest:d,clearToken:d,referenceInUse:a.referenceInUse,osfControl:b,acceptedUpgrade:d,expectedVersion:a.expectedVersion,retried:d})};a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,buttonCallback:Function.createCallback(r,c),url:a._omexEntitlement.endPointUrl,dismissCallback:b,detailView:e,reDisplay:d,highPriority:d,displayDeactive:e,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE})}else if(c.showDeveloperWithDrawWarning)a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveRetiring_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:b,url:a._omexEntitlement.endPointUrl,dismissCallback:b,detailView:e,reDisplay:d,displayDeactive:e,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE});else if(c.showSoftKilled)a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveSoftKilled_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:b,url:a._omexEntitlement.endPointUrl,dismissCallback:b,detailView:e,reDisplay:d,displayDeactive:e,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_FLAGGED});else if(c.showTrialInfo){var o=function(b){var a=b.osfControl;a._refresh({clearCache:d,referenceInUse:b.referenceInUse,osfControl:a})},p=function(b){var a=b.osfControl;window.open(a._omexEntitlement.endPointUrl)};a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Information,title:Strings.OsfRuntime.L_AgaveInformationTitle_TXT,description:Strings.OsfRuntime.L_AgaveTrial_ERR,buttonTxt:Strings.OsfRuntime.L_BuyButton_TXT,buttonCallback:Function.createCallback(p,c),url:b,dismissCallback:b,reDisplay:d,highPriority:d,displayDeactive:e,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_TRIAL_MODE});a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Information,title:Strings.OsfRuntime.L_AgaveInformationTitle_TXT,description:Strings.OsfRuntime.L_AgaveTrialRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:Function.createCallback(o,c),url:b,dismissCallback:b,detailView:d,reDisplay:d,highPriority:d,displayDeactive:e,errorCode:OSF.ErrorStatusCodes.S_USER_CLICKED_BUY})}a._createIframeAndActivateOsfControl(k)}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_lessThan:function(i,j){for(var d=i.split("."),c=j.split("."),f=Math.min(d.length,c.length),e,b,a=0;a<f;a++)try{e=parseFloat(d[a]);b=parseFloat(c[a]);if(e!=b)return e<b}catch(h){}if(d.length>=c.length)return false;else{f=c.length;var g=0;for(a=d.length;a<f;a++){try{b=parseFloat(c[a])}catch(h){b=0}g+=b}return g>0}},_showTrustError:function(g,f,i,e){var b=true,a=this,d=OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveName_INFO,g?g:"");d=a._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(d);var c=OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveProvider_INFO,f?f:"");c=a._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(c);var h=OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveUntrusted_INFO,d,c);a._retryActivate=e;a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.SecurityInfo,title:Strings.OsfRuntime.L_AgaveNewAppTitle_TXT,description:h,buttonTxt:Strings.OsfRuntime.L_ActivateButton_TXT,buttonCallback:e,url:i===OSF.StoreType.OMEX?a._omexEntitlement.endPointUrl:null,dismissCallback:null,reDisplay:b,displayDeactive:b,logAsError:b,retryAll:b,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_MOE_UNACTIVATED})},_showActivationError:function(e,k,i,f,l,c,g,h,d){var b=true,a=this;a._status=e;var j={id:a._id,infoType:OSF.InfoType.Error,status:e,title:g||Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:k,buttonTxt:i||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:f||null,url:l||null,dismissCallback:c||null,reDisplay:!c?b:false,displayDeactive:b,detailView:h?b:false,logAsError:b,errorCode:d?d:0};a._contextActivationMgr.displayNotification(j);a._contextActivationMgr.raiseOsfControlStatusChange(a)},_showActivationWarning:function(d,h,f,e,i,b,c){var a=this;a._status=d;var g={id:a._id,infoType:OSF.InfoType.Warning,status:d,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:h,buttonTxt:f||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:e||null,url:i||null,dismissCallback:b||null,reDisplay:!b?true:false,displayDeactive:true,logAsError:true,errorCode:c?c:0};a._contextActivationMgr.displayNotification(g);a._contextActivationMgr.raiseOsfControlStatusChange(a)},_refresh:function(a){this.deActivate();this.activate(a)},_activateAgavesBlockedBySandboxNotSupport:function(b){b.activateAgavesBlockedBySandboxNotSupport();var a=OSF.OUtil.getLocalStorage();a&&a.setItem(OSF.Constants.IgnoreSandBoxSupport,"true")},_setCachedFlag:function(a){this._contextActivationMgr._setCachedFlag(a)},_getCachedFlag:function(a){return this._contextActivationMgr._getCachedFlag(a)},_deleteCachedFlag:function(a){this._contextActivationMgr._deleteCachedFlag(a)},_addETokenAsQueryParameter:function(e){var a=document.createElement("a");a.href=e;var f=this.getEToken(),b=OSF.Constants.ETokenParameterName+"="+encodeURIComponent(OSF.OUtil.encodeBase64(f)),d=a.search.length>1?a.search.substr(1)+"&":"";a.search=d+b;var c=a.href;a=null;return c},_activate:function(c,d){var a=this;Telemetry.AppLoadTimeHelper.PageStart(a._telemetryContext);d=a._addETokenAsQueryParameter(d);var f=a._contextActivationMgr.getClientId()+"_"+a._contextActivationMgr.getDocUrl()+"_"+a._id;a._conversationId=OSF.OUtil.getFrameNameAndConversationId(f,c);var e=function(d,e){d=d.trim()||"";var f="?",k="_host_Info=",g="&_host_Info=",c="#",i=d.split(c),b=i.shift(),j=i.join(c),h=b.split(f),a;if(h.length>1)a=b+g+e;else if(h.le>0)a=b+f+g+e;return [a,c,j].join("")},b=e(d,a._contextActivationMgr._hostType+"|"+a._contextActivationMgr._hostPlatform+"|"+a._contextActivationMgr._hostSpecificFileVersion);b=OSF.OUtil.addXdmInfoAsHash(b,a._conversationId+"|"+a._id+"|"+window.location.href);a._contextActivationMgr._getServiceEndPoint().registerConversation(a._conversationId,b);a._pageIsReadyTimerExpired=false;OSF.OUtil.addEventListener(c,"load",a._iframeOnLoadDelegate);c.setAttribute("src",b);a._div.appendChild(c);a._status=OSF.OsfControlStatus.Activated;OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.ActivationEnd);a._contextActivationMgr.raiseOsfControlStatusChange(a);Telemetry.AppLoadTimeHelper.OfficeJSStartToLoad(a._telemetryContext)},_getConversationId:function(){return this._conversationId},_doesBrowserSupportRequiredFeatures:function(){var a=false;if(Object.defineProperty)try{Object.defineProperty({},"myTestProperty",{"get":function(){return this.desc},"set":function(a){this.desc=a}});a=true}catch(b){}return a}};OSF.OUtil.setNamespace("Manifest",OSF);OSF.Manifest.HostApp=function(a){this._appName=a;this._minVersion=null};OSF.Manifest.HostApp.prototype={getAppName:function(){return this._appName},getMinVersion:function(){return this._minVersion},_setMinVersion:function(a){this._minVersion=a}};OSF.Manifest.ExtensionSettings=function(){this._sourceLocations={};this._defaultHeight=null;this._defaultWidth=null};OSF.Manifest.ExtensionSettings.prototype={getDefaultHeight:function(){return this._defaultHeight},getDefaultWidth:function(){return this._defaultWidth},getSourceLocations:function(){return this._sourceLocations},_addSourceLocation:function(a,b){this._sourceLocations[a]=b},_setDefaultWidth:function(a){this._defaultWidth=a},_setDefaultHeight:function(a){this._defaultHeight=a}};OSF.Manifest.Manifest=function(c,g){var a=this;a._UILocale=g||"en-us";if(typeof c!=="string"){c(a);return}a._displayNames={};a._descriptions={};a._iconUrls={};a._extensionSettings={};a._highResolutionIconUrls={};var d;a._xmlProcessor=new OSF.XmlProcessor(c,OSF.ManifestNamespaces["1.1"]);if(a._xmlProcessor.selectSingleNode("//o:OfficeApp")){d=f;a._manifestSchemaVersion=OSF.ManifestSchemaVersion["1.1"]}else{a._xmlProcessor=new OSF.XmlProcessor(c,OSF.ManifestNamespaces["1.0"]);d=e;a._manifestSchemaVersion=OSF.ManifestSchemaVersion["1.0"]}var b=a._xmlProcessor.getDocumentElement();a._target=OSF.OUtil.parseEnum(b.getAttribute("xsi:type"),OSF.OfficeAppType);b=a._xmlProcessor.selectSingleNode("//o:Id");a._id=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:Version");a._version=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:ProviderName");a._providerName=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:IdIssuer");a._idIssuer=a._parseIdIssuer(b);b=a._xmlProcessor.selectSingleNode("//o:AlternateId");if(b)a._alternateId=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:DefaultLocale");a._defaultLocale=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:DisplayName");a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addDisplayName));b=a._xmlProcessor.selectSingleNode("//o:Description");a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addDescription));b=a._xmlProcessor.selectSingleNode("//o:IconUrl");b&&a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addIconUrl));b=a._xmlProcessor.selectSingleNode("//o:Signature");if(b)a._signature=a._xmlProcessor.getNodeValue(b);a._parseExtensionSettings();b=a._xmlProcessor.selectSingleNode("//o:Permissions");a._permissions=a._parsePermission(b);d.apply(a);function e(){var a=this._xmlProcessor.selectNodes("//o:Capabilities/o:Capability");this._capabilities=this._parseCapabilities(a)}function f(){var a=this,b=a._xmlProcessor.selectSingleNode("//o:Hosts");a._hosts=a._parseHosts(b);b=a._xmlProcessor.selectSingleNode("//o:Requirements");a._requirements=a._parseRequirements(b);b=a._xmlProcessor.selectSingleNode("//o:HighResolutionIconUrl");b&&a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addHighResolutionIconUrl))}};OSF.Manifest.Manifest.prototype={getManifestSchemaVersion:function(){return this._manifestSchemaVersion},getMarketplaceID:function(){return this._id},getMarketplaceVersion:function(){return this._version},getDefaultLocale:function(){return this._defaultLocale},getProviderName:function(){return this._providerName},getIdIssuer:function(){return this._idIssuer},getAlternateId:function(){return this._alternateId},getSignature:function(){return this._signature},getCapabilities:function(){return this._capabilities},getDisplayName:function(a){return this._displayNames[a]},getDefaultDisplayName:function(){return this._getDefaultValue(this._displayNames)},getDescription:function(a){return this._descriptions[a]},getDefaultDescription:function(){return this._getDefaultValue(this._descriptions)},getIconUrl:function(a){return this._iconUrls[a]},getDefaultIconUrl:function(){return this._getDefaultValue(this._iconUrls)},getSourceLocation:function(d,c){var a=this._getExtensionSetting(c),b=a.getSourceLocations();return b[d]},getDefaultSourceLocation:function(c){var a=this._getExtensionSetting(c),b=a.getSourceLocations();return this._getDefaultValue(b)},getDefaultWidth:function(b){var a=this._getExtensionSetting(b);return a.getDefaultWidth()},getDefaultHeight:function(b){var a=this._getExtensionSetting(b);return a.getDefaultHeight()},getTarget:function(){return this._target},getPermission:function(){return this._permissions},hasPermission:function(a){return (this._permissions&a)===a},getHosts:function(){return this._hosts},getRequirements:function(){return this._requirements},getHighResolutionIconUrl:function(a){return this._highResolutionIconUrls[a]},_getDefaultValue:function(c){var d="undefined",b=this,a;if(typeof c[b._UILocale]==d)if(typeof c[b._defaultLocale]==d)for(var e in c){a=e;break}else a=b._defaultLocale;else a=b._UILocale;return c[a]},_getExtensionSetting:function(c){var a=this,b;if(typeof a._extensionSettings[c]!="undefined")b=a._extensionSettings[c];else for(var d in a._extensionSettings){b=a._extensionSettings[d];break}return b},_addDisplayName:function(a,b){this._displayNames[a]=b},_addDescription:function(a,b){this._descriptions[a]=b},_addIconUrl:function(a,b){this._iconUrls[a]=b},_parseLocaleAwareSettings:function(a,d){if(!a)throw Error.argument("Manifest");var f=a.getAttribute("DefaultValue");d(this._defaultLocale,f);var b=this._xmlProcessor.selectNodes("o:Override",a);if(b)for(var i=b.length,c=0;c<i;c++){var e=b[c],g=e.getAttribute("Locale"),h=e.getAttribute("Value");d(g,h)}},_parseBooleanNode:function(b){if(!b)return false;else{var a=this._xmlProcessor.getNodeValue(b).toLowerCase();return a==="true"||a==="1"}},_parseIdIssuer:function(a){if(!a)return OSF.ManifestIdIssuer.Custom;else{var b=this._xmlProcessor.getNodeValue(a);return OSF.OUtil.parseEnum(b,OSF.ManifestIdIssuer)}},_parseCapabilities:function(d){for(var c=[],a,b=0;b<d.length;b++){var e=d[b];a=e.getAttribute("Name");a=OSF.OUtil.parseEnum(a,OSF.Capability);c.push(a)}return c},_parsePermission:function(a){if(!a)throw Error.argument("Manifest");var b=this._xmlProcessor.getNodeValue(a);return OSF.OUtil.parseEnum(b,OSF.OsfControlPermission)},_parseExtensionSettings:function(){var a=this,c,d,b;for(var e in OSF.FormFactor){d=a._xmlProcessor.selectSingleNode("//o:"+OSF.FormFactor[e]);if(d){c=new OSF.Manifest.ExtensionSettings;b=a._xmlProcessor.selectSingleNode("o:SourceLocation",d);var f=function(a,b){c._addSourceLocation(a,b)};a._parseLocaleAwareSettings(b,f);b=a._xmlProcessor.selectSingleNode("o:RequestedWidth",d);b&&c._setDefaultWidth(a._xmlProcessor.getNodeValue(b));b=a._xmlProcessor.selectSingleNode("o:RequestedHeight",d);b&&c._setDefaultHeight(a._xmlProcessor.getNodeValue(b));a._extensionSettings[e]=c}}if(!c)throw Error.argument("Manifest")},_parseHosts:function(d){var b=[];if(d)for(var c=this._xmlProcessor.selectNodes("//o:Host",d),a=0;a<c.length;a++)b.push(c[a].getAttribute("Name"));return b},_parseRequirements:function(b){var a=this,c={sets:[],methods:[]};if(b){var e=a._xmlProcessor.selectSingleNode("//o:Sets",b);c.sets=a._parseSets(e);var d=a._xmlProcessor.selectSingleNode("//o:Methods",b);c.methods=a._parseMethods(d)}return c},_parseSets:function(a){var e=[];if(a)for(var g=a.getAttribute("DefaultMinVersion"),c=this._xmlProcessor.selectNodes("//o:Set",a),b=0;b<c.length;b++){var d=c[b],f=d.getAttribute("MinVersion");e.push({name:d.getAttribute("Name"),version:f||g})}return e},_parseMethods:function(c){var d=[];if(c)for(var b=this._xmlProcessor.selectNodes("//o:Method",c),a=0;a<b.length;a++)d.push(b[a].getAttribute("Name"));return d},_addHighResolutionIconUrl:function(a,b){this._highResolutionIconUrls[a]=b}};OSF.OUtil.setNamespace("AppSpecificSetup",OSF);OSF.ContextActivationManager=function(f){var h="osfControl for the given ID doesn't exist.",c=null,e=true,b=false,a=this;OSF.OUtil.validateParamObject(f,{appName:{type:Number,mayBeNull:b},appVersion:{type:String,mayBeNull:b},clientMode:{type:Number,mayBeNull:b},appUILocale:{type:String,mayBeNull:b},dataLocale:{type:String,mayBeNull:b},osfOmexBaseUrl:{type:String,mayBeNull:e},spBaseUrl:{type:String,mayBeNull:e},docUrl:{type:String,mayBeNull:e},hostControl:{type:Object,mayBeNull:e},pageBaseUrl:{type:String,mayBeNull:e},lcid:{type:String,mayBeNull:e},formFactor:{type:String,mayBeNull:e},controlStatusChanged:{type:Object,mayBeNull:e},notifyHost:{type:Object,mayBeNull:e},allowExternalMarketplace:{type:Boolean,mayBeNull:e},localizedScriptsUrl:{type:String,mayBeNull:e},localizedImagesUrl:{type:String,mayBeNull:e},localizedStylesUrl:{type:String,mayBeNull:e},localizedResourcesUrl:{type:String,mayBeNull:e},trustAgaves:{type:Boolean,mayBeNull:e},enableMyOrg:{type:Boolean,mayBeNull:e},enableMyApps:{type:Boolean,mayBeNull:e},omexForceAnonymous:{type:Boolean,mayBeNull:e}},c);a._osfOmexBaseUrl=f.osfOmexBaseUrl;a._spBaseUrl=f.spBaseUrl;a._myOrgCatalogUrl=c;a._enableMyOrg=f.enableMyOrg||b;a._enableMyApps=f.enableMyApps||b;a._appName=f.appName;a._appVersion=f.appVersion;a._clientMode=f.clientMode;a._appUILocale=f.appUILocale;a._dataLocale=f.dataLocale;a._docUrl=f.docUrl;a._hostControl=f.hostControl;a._formFactor=f.formFactor||OSF.FormFactor.Default;a._pageBaseUrl=f.pageBaseUrl;a._lcid=f.lcid;a._controlStatusChanged=f.controlStatusChanged;a._notifyHost=f.notifyHost;a._allowExternalMarketplace=f.allowExternalMarketplace;a._localizedScriptsUrl=f.localizedScriptsUrl;a._localizedImagesUrl=f.localizedImagesUrl;a._localizedStylesUrl=f.localizedStylesUrl;a._localizedResourcesUrl=f.localizedResourcesUrl;a._autoTrusted=f.trustAgaves;a._omexForceAnonymous=f.omexForceAnonymous||b;if(a._pageBaseUrl&&a._pageBaseUrl.charAt(a._pageBaseUrl.length-1)!=="/")a._pageBaseUrl=a._pageBaseUrl+"/";if(a._localizedResourcesUrl&&a._localizedResourcesUrl.charAt(a._localizedResourcesUrl.length-1)!=="/")a._localizedResourcesUrl=a._localizedResourcesUrl+"/";a._clientId=OSF.OUtil.getUniqueId();a._cachedOsfControls={};a._iframeAttributeBag={};a._serviceEndPoint=c;a._serviceEndPointInternal=c;a._internalConversationId=c;a._iframeProxies={};a._iframeProxyCount=0;a._iframeNamePrefix="__officeExtensionProxy";a._webUrl=c;a._wsa=c;a._insertDialogDiv=c;a._hostType=c;a._hostPlatform=c;a._hostSpecificFileVersion=c;a._requirementsChecker=new OSF.RequirementsChecker;if(a._osfOmexBaseUrl){var g,i=a._osfOmexBaseUrl.indexOf(OSF.Constants.ProtocolSeparator);if(i>=0)g=a._osfOmexBaseUrl.substr(i);else g=OSF.Constants.ProtocolSeparator+a._osfOmexBaseUrl;var k=OSF.Constants.Https+g,j=OSF.Constants.Https+g;if(OSF.OUtil.getQueryStringParamValue(window.location.search,OSF.Constants.OmexForceAnonymousParamName).toLowerCase()==OSF.Constants.OmexForceAnonymousParamValue.toLowerCase()){a._omexAuthNStatus=OSF.OmexAuthNStatus.Anonymous;a._omexForceAnonymous=e}else a._omexAuthNStatus=OSF.OmexAuthNStatus.NotAttempted;a._omexGatedWSProxy={proxyUrl:k+OSF.Constants.OmexGatedServiceExtension,proxyName:"__omexExtensionGatedProxy",isReady:b,clientEndPoint:c,pendingCallbacks:[]};a._omexWSProxy={proxyUrl:j+OSF.Constants.OmexUnGatedServiceExtension,proxyName:"__omexExtensionProxy",isReady:b,clientEndPoint:c,pendingCallbacks:[]};a._omexAnonymousWSProxy={proxyUrl:k+OSF.Constants.OmexAnonymousServiceExtension,proxyName:"__omexExtensionAnonymousProxy",isReady:b,clientEndPoint:c,pendingCallbacks:[]};a._omexBillingMarket=c;a._omexEndPointBaseUrl=j}OSF.OsfManifestManager._setUILocale(a._appUILocale);var d=a,q=function(g,k){var f="contextId",i=Function._validateParams(arguments,[{name:f,type:String,mayBeNull:b},{name:"gotAppContext",type:Function,mayBeNull:b}]);if(i)throw i;var a=d.getOsfControl(g);if(!a){Sys.Debug.trace(h);throw Error.argument(f)}else{Telemetry.AppLoadTimeHelper.OfficeJSLoaded(a._telemetryContext);var m=a.getEToken(),l=new OSF.OfficeAppContext(g,d._appName,d._appVersion,d._appUILocale,d._dataLocale,d._docUrl||window.location.href,d._clientMode,a.getSettings(),a.getReason(),a.getOsfControlType(),m,a._appCorrelationId,a._appInstanceId);k(l);a._pageIsReady=e;a._pageIsReadyTimerExpired&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("App attempted to retrieve context after app activation error has occured.",c,a._appCorrelationId,6062164);a._contextActivationMgr._ErrorUXHelper&&a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);if(a._timer){window.clearTimeout(a._timer);a._timer=c}var j=a._conversationId+OSF.SharedConstants.NotificationConversationIdSuffix;a._agaveEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(j,a._frame.contentWindow,a._iframeUrl);Telemetry.AppLoadTimeHelper.ActivationEnd(a._telemetryContext)}},w=function(a){(!a||a.length!=2)&&Sys.Debug.trace("ContextActivationManager_notifyHost params is wrong.");var c=a[0],e=a[1],b=d.getOsfControl(c);if(!b)Sys.Debug.trace(h);else if(b._contextActivationMgr._notifyHost)b._contextActivationMgr._notifyHost(c,e);else Sys.Debug.trace("No notifyHost provided by the host.")},t=function(a){window.open(a.strUrl,a.strWindowName,a.strWindowFeatures)},m=function(f,h){d._insertDialogDiv.childNodes.length==2&&d._insertDialogDiv.removeChild(d._insertDialogDiv.lastChild);var i={MarketPlace:0,Catalog:1},g;if(f.storeType==i.MarketPlace)g={storeType:OSF.StoreType.OMEX,storeLocator:d._osfOmexBaseUrl};else if(f.storeType==i.Catalog)g={storeType:OSF.StoreType.SPCatalog,storeLocator:d._myOrgCatalogUrl};var a={assetId:"",contentMarket:"",anonymous:b,clientEndPoint:c,clearCache:b||f.refresh,clearKilledApps:b,referenceInUse:g,hostType:d._hostType},j=1;if(f&&f.storeType==i.MarketPlace){a.clientVersion=d._getClientVersionForOmex();if(a.clientVersion){a.clientName=d._getClientNameForOmex();a.appVersion=d._getAppVersionForOmex()}var l=function(g){if(g.statusCode===OSF.ProxyCallStatusCode.Succeeded&&g.value){var t=g.context.referenceInUse,o=g.value.entitlements,i=o.length;i===0&&h({errorCode:OSF.InvokeResultCode.S_OK});for(var f,c={},q=[],k=0;k<i;k++){f=o[k];if(c[f.contentMarket])c[f.contentMarket]+=","+f.assetId;else c[f.contentMarket]=f.assetId}j=1;var p=0,m=function(f){if(f.statusCode===OSF.ProxyCallStatusCode.Succeeded&&f.value&&f.value.length&&f.value.length>0){var b=f.value;!f.cached&&_omexDataProvider.SetAppDetailsCache(a,b);if(a.appDetails&&a.appDetails.length>0)for(var g=0;g<a.appDetails.length;g++)b.push(a.appDetails[g]);for(var j=d.getRequirementsChecker(),e=0;e<b.length;e++){if(j.isEntitlementFromOmexSupported(b[e])){var c=[];c.push(b[e].name);c.push(b[e].assetId);c.push(b[e].description);c.push(OSF.OUtil.getTargetType(b[e].appSubType));c.push(OSF.OUtil.normalizeAppVersion(b[e].version));c.push(b[e].assetId);c.push(OSF.StoreType.OMEX);c.push(parseInt(b[e].defaultWidth));c.push(parseInt(b[e].defaultHeight));c.push(b[e].iconUrl);c.push(b[e].provider);c.push(f.context.contentMarket);c.push(OSF.StoreType.OMEX);q.push(c)}p++}}if(p===i){var k={value:q,errorCode:OSF.InvokeResultCode.S_OK};h(k)}},l=function(e){if(e)for(var f in c){a.anonymous=b;a.clientEndPoint=e;a.assetId=c[f];a.contentMarket=f;var h=OSF.OUtil.shallowCopy(a);OSF.OsfManifestManager.getOmexAppDetailsAsync(h,Function.createDelegate(d,m))}else if(j<OSF.Constants.AuthenticatedConnectMaxTries){j++;d._createOmexProxy(d._omexWSProxy,l)}else{var i=window.location.href,g=d._osfOmexBaseUrl+OSF.Constants.SignInRedirectUrl+encodeURIComponent(i);window.location.assign(g)}},n=e;if(_omexDataProvider.AppDetailsCached(a,c))try{a.clientEndPoint=d._omexWSProxy.clientEndPoint;for(var r in c){a.anonymous=b;a.assetId=c[r];a.contentMarket=r;OSF.OsfManifestManager.getOmexAppDetailsAsync(a,Function.createDelegate(d,m))}n=b}catch(s){}n&&d._createOmexProxy(d._omexWSProxy,l)}},m=function(e){if(e.isReady){a.anonymous=b;a.clientEndPoint=e.clientEndPoint;OSF.OsfManifestManager.getOmexEntitlementsAsync(a,Function.createDelegate(d,l))}else{var f={value:c,errorCode:OSF.InvokeResultCode.E_USER_NOT_SIGNED_IN};h(f)}};d._omexGatedWSProxy.refresh=f.refresh;d.isMyAppsReady(m)}else if(f&&f.storeType==i.Catalog){var k=function(e){e.context&&e.context.referenceInUse.storeType===OSF.StoreType.SPCatalog&&OSF.OUtil.writeProfilerMark(OSF.OsfOfficeExtensionManagerPerfMarker.GetEntitlementEnd);var f;if(e.statusCode===OSF.ProxyCallStatusCode.Succeeded&&e.value){for(var k=e.value.entitlements,n=k.length,b,l=[],j=0,m=d.getRequirementsChecker(),i=0;i<n;i++){b=k[i];if(m.isEntitlementFromCorpCatalogSupported(b)){var a=[];a.push(b.Title);a.push(b.OfficeExtensionID);a.push(b.OfficeExtensionDescription);a.push(OSF.OfficeAppType[b.OEType]);a.push(OSF.OUtil.normalizeAppVersion(b.OfficeExtensionVersion));a.push(b.OfficeExtensionID);a.push(OSF.StoreType.SPCatalog);a.push(parseInt(b.OfficeExtensionDefaultWidth.toString()));a.push(parseInt(b.OfficeExtensionDefaultHeight.toString()));a.push(b.OfficeExtensionIcon);a.push(b.OEProviderName);a.push(g.storeLocator);a.push(OSF.StoreType.SPCatalog);l.push(a);j++}}if(j>0)f={value:l,errorCode:OSF.InvokeResultCode.S_OK};else f={value:c,errorCode:OSF.InvokeResultCode.E_CATALOG_NO_APPS}}else if(!g.storeLocator)f={value:c,errorCode:OSF.InvokeResultCode.E_CATALOG_NO_APPS};else f={value:c,errorCode:OSF.InvokeResultCode.E_GENERIC_ERROR};h(f)};a.webUrl=g.storeLocator;a.osfControl={_contextActivationMgr:d,_telemetryContext:{}};a.noTargetType=e;OSF.OsfManifestManager.getCorporateCatalogEntitlementsAsync(a,Function.createDelegate(d,k))}else Sys.Debug.trace("Unknown storey type.")},u=function(){var b=window.location.href,a=d._osfOmexBaseUrl+OSF.Constants.SignInRedirectUrl+encodeURIComponent(b);window.location.assign(a)},s=function(a){window.open(a.pageUrl)},o=function(a){Sys.Debug.trace("onClickInsertOsfControl!");d._notifyHost("0",OSF.AgaveHostAction.InsertAgave,a)},p=function(){Sys.Debug.trace("onClickCancelDialog!");d._notifyHost("0",OSF.AgaveHostAction.CancelDialog);if(d._internalConversationId){d._serviceEndPointInternal.unregisterConversation(d._internalConversationId);d._internalConversationId=c}},v=function(f){var a={anonymous:c,clientAppInfoReturnType:OSF.ClientAppInfoReturnType.both,clientEndPoint:c,clientName:c,appVersion:c,clientVersion:c,hostType:c,osfControl:{_omexEntitlement:c},referenceInUse:c},j=e;a.referenceInUse={id:f.assetId,storeType:OSF.StoreType.OMEX,storeLocator:f.storeId};a.clientVersion=d._getClientVersionForOmex();if(a.clientVersion){a.clientName=d._getClientNameForOmex();a.appVersion=d._getAppVersionForOmex()}a.hostType=d._hostType;f.contentMarket=f.storeId;f.assetID=f.assetId;if(_omexDataProvider.AllCached(a,f))try{a.anonymous=e;a.clientEndPoint={};OSF.OsfManifestManager.getOmexKilledAppsAsync(a,i);OSF.OsfManifestManager.getOmexAppStateAsync(a,g);j=b}catch(m){}if(j){var k=function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){var j=a.context.referenceInUse,i=a.value.entitlements,l=i.length,d,k=b;_omexDataProvider.SetCustomerId(a.value.cid);for(var h=0;h<l;h++){d=i[h];if(d.assetId&&j.id&&d.assetId.toLowerCase()===j.id.toLowerCase()){k=e;break}}var f=a.context;f.osfControl._omexEntitlement={contentMarket:c,hasEntitlement:b,version:c};if(k){f.osfControl._omexEntitlement.contentMarket=d.contentMarket;f.osfControl._omexEntitlement.hasEntitlement=e;f.osfControl._omexEntitlement.version=d.version}OSF.OsfManifestManager.getOmexAppStateAsync(f,g)}},h=function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){var b=a.value,c=parseInt(b.status),d=a.context;if(c===OSF.OmexClientAppStatus.OK)!a.cached&&_omexDataProvider.SetManifestAndETokenCache(d,b)}},i=function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value)!a.cached&&_omexDataProvider.SetKilledAppsCache(a.context,a.value)},g=function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){var f=a.value,b=a.context;!a.cached&&_omexDataProvider.SetAppStateCache(a.context,f);var c=function(){b.clientEndPoint=d._omexAnonymousWSProxy.clientEndPoint;OSF.OsfManifestManager.getOmexManifestAndETokenAsync(b,h)};if(b.osfControl._omexEntitlement&&!b.osfControl._omexEntitlement.hasEntitlement){b.anonymous=e;d._createOmexProxy(d._omexAnonymousWSProxy,c)}else OSF.OsfManifestManager.getOmexManifestAndETokenAsync(b,h)}},l=function(b){try{a.anonymous=!b.isReady;a.clientEndPoint=a.anonymous?d._omexAnonymousWSProxy.clientEndPoint:d._omexGatedWSProxy.clientEndPoint;!a.anonymous&&OSF.OsfManifestManager.getOmexEntitlementsAsync(a,k);OSF.OsfManifestManager.getOmexKilledAppsAsync(a,i);a.anonymous&&OSF.OsfManifestManager.getOmexAppStateAsync(a,g)}catch(c){}};d.isMyAppsReady(l)}},n=function(e,h){var c={errorCode:OSF.InvokeResultCode.E_OEM_REMOVED_FAILED},a={assetId:e.id,clientVersion:d._getClientVersionForOmex(),clientName:d._getClientNameForOmex(),clientEndPoint:d._omexGatedWSProxy.clientEndPoint},g=d._insertDialogDiv,f=function(f){var l=0;if(f.statusCode===OSF.ProxyCallStatusCode.Succeeded&&f.value&&f.value.removedApps&&f.value.removedApps.length>0){for(var k=f.value.removedApps,j=OSF.InvokeResultCode.E_OEM_REMOVED_FAILED,i=0;i<k.length;i++)if(k[i].assetId==a.assetId){if(k[i].result==OSF.OmexRemoveAppStatus.Success)j=OSF.InvokeResultCode.S_OK;break}_omexDataProvider.RemoveManifestAndEToken(a.assetId);if(j==OSF.InvokeResultCode.S_OK)l=d.untrustOsfControls(e);c.errorCode=j}var m=!document.documentElement.contains(g);Telemetry.AppManagementMenuHelper.LogAppManagementMenuAction(a.assetId,OSF.AppManagementAction.Remove,l,m,b,c.errorCode);h(c)};OSF.OsfManifestManager.removeOmexAppAsync(a,Function.createDelegate(d,f))},l=function(a){switch(a.datapointName){case OSF.DataPointNames.AppManagementMenu:OSF.OUtil.validateParamObject(a,{assetId:{type:String,mayBeNull:b},operationMetadata:{type:Number,mayBeNull:b},hrStatus:{type:Number,mayBeNull:b}},c);Telemetry.AppManagementMenuHelper.LogAppManagementMenuAction(a.assetId,a.operationMetadata,0,b,b,a.hrStatus);break;case OSF.DataPointNames.InsertionDialogSession:OSF.OUtil.validateParamObject(a,{assetId:{type:String,mayBeNull:b},totalSessionTime:{type:Number,mayBeNull:b},trustPageSessionTime:{type:Number,mayBeNull:b},appInserted:{type:Boolean,mayBeNull:b},lastActiveTab:{type:Number,mayBeNull:b},lastActiveTabCount:{type:Number,mayBeNull:b}},c);Telemetry.InsertionDialogSessionHelper.LogInsertionDialogSession(a.assetId,a.totalSessionTime,a.trustPageSessionTime,a.appInserted,a.lastActiveTab,a.lastActiveTabCount)}};a._serviceEndPoint=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(a._clientId);a._serviceEndPoint.registerMethod("ContextActivationManager_getAppContextAsync",q,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPoint.registerMethod("ContextActivationManager_notifyHost",w,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPoint.registerMethod("ContextActivationManager_openWindowInHost",t,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(a._clientId+OSF.Constants.EndPointInternalSuffix);a._serviceEndPointInternal.registerMethod("ContextActivationManager_getEntitlementsForInsertDialog",m,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeSignIn",u,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeWindowOpen",s,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickInsertOsfControl",o,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickCancelDialog",p,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_removeAppForInsertDialog",n,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_logTelemetryDataForInsertDialog",l,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_getOmexData",v,Microsoft.Office.Common.InvokeType.async,b);OSF.AppSpecificSetup._setupFacade(a._hostControl,a,a._serviceEndPoint,a._serviceEndPointInternal);a._localeStringLoadingPendingCallbacks=[];if(a._localizedScriptsUrl&&a._localizedScriptsUrl!="null/"){var r=function(){this._ErrorUXHelper=new OSF._ErrorUXHelper(this)};a._loadLocaleString(Function.createDelegate(a,r))}};OSF.ContextActivationManager.prototype={insertOsfControl:function(a){var d=true,c=false,f=this;OSF.OUtil.validateParamObject(a,{div:{type:Object,mayBeNull:c},id:{type:String,mayBeNull:c},marketplaceID:{type:String,mayBeNull:c},marketplaceVersion:{type:String,mayBeNull:c},store:{type:String,mayBeNull:c},storeType:{type:String,mayBeNull:c},alternateReference:{type:Object,mayBeNull:d},settings:{type:Object,mayBeNull:d},reason:{type:String,mayBeNull:d},osfControlType:{type:Number,mayBeNull:d},snapshotUrl:{type:String,mayBeNull:d},preactivationCallback:{type:Object,mayBeNull:d}},null);var e={div:a.div,id:a.id,marketplaceID:a.marketplaceID,marketplaceVersion:a.marketplaceVersion,store:a.store,storeType:a.storeType,alternateReference:a.alternateReference,settings:a.settings,reason:a.reason,osfControlType:a.osfControlType,snapshotUrl:a.snapshotUrl,contextActivationMgr:f,preactivationCallback:a.preactivationCallback},g=f.getSQMAgaveUsage(e.storeType,e.osfControlType,e.reason,a.marketplaceID),b=new OSF.OsfControl(e);b._sqmDWords[0]=g[0];b._sqmDWords[1]=g[1];b._contextActivationMgr._ErrorUXHelper&&b._contextActivationMgr._ErrorUXHelper.showProgress(b._div,b._id);var h=function(){b.activate()};f._loadLocaleString(Function.createDelegate(f,h));return b},setLocalizedUrl:function(d,e,f){var a=this,b=Function._validateParams(arguments,[{name:"scriptUrl",type:String,mayBeNull:false},{name:"imageUrl",type:String,mayBeNull:false},{name:"styleUrl",type:String,mayBeNull:false}]);if(b)throw b;a._localizedScriptsUrl=d;a._localizedImagesUrl=e;a._localizedStylesUrl=f;if(a._localizedScriptsUrl&&a._localizedScriptsUrl!="null/"){var c=function(){if(!this._ErrorUXHelper)this._ErrorUXHelper=new OSF._ErrorUXHelper(this)};a._loadLocaleString(Function.createDelegate(a,c))}},activateOsfControl:function(c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[c];typeof a!="undefined"&&a.activate()},deActivateOsfControl:function(c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[c];typeof a!="undefined"&&a.deActivate()},purgeOsfControl:function(d,c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false},{name:"purgeManifest",type:Boolean,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[d];typeof a!="undefined"&&a.purge(c)},purgeOsfControlNotifications:function(){for(var a in this._cachedOsfControls)this._ErrorUXHelper.purgeOsfControlNotification(a)},untrustOsfControls:function(a){var c=this,d=0,e=OSF.OUtil.formatString(OSF.Constants.ActivatedCacheKey,a.id.toLowerCase(),a.currentStoreType,a.storeId);c._deleteCachedFlag(e);for(var f in c._cachedOsfControls){var b=c._cachedOsfControls[f];if(b._marketplaceID.toLowerCase()==a.id.toLowerCase()){c._ErrorUXHelper.purgeOsfControlNotification(b._id);b.deActivate();b._showTrustError(a.displayName,a.providerName,a.currentStoreType,Function.createDelegate(b,b.activate));d++}}return d},retryAll:function(d){var b=this;for(var c in b._cachedOsfControls){var a=b._cachedOsfControls[c];if(a._marketplaceID.toLowerCase()==d.toLowerCase())if(a._retryActivate){b._ErrorUXHelper.purgeOsfControlNotification(a._id);b._ErrorUXHelper.removeInfoBarDiv(c,false);a._retryActivate();a._retryActivate=null}}},getOsfControl:function(b){var a=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(a)throw a;return this._cachedOsfControls[b]},getOsfControls:function(){var a=[];for(var b in this._cachedOsfControls)a.push(this._cachedOsfControls[b]);return a},getOsfOmexBaseUrl:function(){return this._osfOmexBaseUrl},getAppName:function(){return this._appName},getClientMode:function(){return this._clientMode},getClientId:function(){return this._clientId},getFormFactor:function(){return this._formFactor},getDocUrl:function(){return this._docUrl},getAppUILocale:function(){return this._appUILocale},getDataLocale:function(){return this._dataLocale},getPageBaseUrl:function(){return this._pageBaseUrl},getLcid:function(){return this._lcid},isExternalMarketplaceAllowed:function(){return this._allowExternalMarketplace},getLocalizedScriptsUrl:function(){return this._localizedScriptsUrl?this._localizedScriptsUrl:""},getLocalizedImagesUrl:function(){return this._localizedImagesUrl?this._localizedImagesUrl:""},getLocalizedStylesUrl:function(){return this._localizedStylesUrl?this._localizedStylesUrl:""},raiseOsfControlStatusChange:function(a){this._controlStatusChanged&&this._controlStatusChanged(a)},registerOsfControl:function(a){var b=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:false}]);if(b)throw b;this._cachedOsfControls[a.getID()]=a},unregisterOsfControl:function(b){var a=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:false}]);if(a)throw a;delete this._cachedOsfControls[b.getID()]},setIframeAttributeBag:function(a){this._iframeAttributeBag=a},displayNotification:function(b){var a=true,c=false;OSF.OUtil.validateParamObject(b,{infoType:{type:Number,mayBeNull:c},id:{type:String,mayBeNull:c},title:{type:String,mayBeNull:c},description:{type:String,mayBeNull:c},url:{type:String,mayBeNull:a},buttonTxt:{type:String,mayBeNull:a},buttonCallback:{type:Function,mayBeNull:a},dismissCallback:{type:Function,mayBeNull:a},"displayDeactive ":{type:Boolean,mayBeNull:a},highPriority:{type:Boolean,mayBeNull:a},detailView:{type:Boolean,mayBeNull:a},reDisplay:{type:Boolean,mayBeNull:a},logAsError:{type:Boolean,mayBeNull:a},errorCode:{type:Number,mayBeNull:a},retryAll:{type:Boolean,mayBeNull:a}},null);if(!b.errorCode)b.errorCode=0;var d=this._cachedOsfControls[b.id];if(d){b.logAsError&&Telemetry.AppLoadTimeHelper.SetErrorResult(d._telemetryContext,b.errorCode);if(b.displayDeactive)b.detailView=a;b["div"]=d._div;this._ErrorUXHelper.showNotification(b)}},dismissMessages:function(a){this._ErrorUXHelper&&this._ErrorUXHelper.dismissMessages(a)},notifyAgave:function(c,b){var d=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false},{name:"actionId",type:Number,mayBeNull:false}]);if(d)throw d;var a=this._cachedOsfControls[c];if(typeof a!="undefined")if(!a._pageIsReady&&(b===OSF.AgaveHostAction.CtrlF6In||b===OSF.OSF.AgaveHostAction.Select))this._ErrorUXHelper.focusOnNotificationUx(c);else a.notifyAgave(b)},setWSA:function(b){var a=this;a._wsa=b;if(a._wsa){a._wsa.createStreamUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICEUSAGE,OSF.BWsaStreamTypes.Static,2,OSF.BWsaConfig.defaultMaxStreamRows);a._wsa.createStreamUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICENOTIFICATIONS,OSF.BWsaStreamTypes.Static,4,OSF.BWsaConfig.defaultMaxStreamRows)}},getWSA:function(){return this._wsa},getSQMAgaveUsage:function(h,i,d,e){var a;switch(h.toLowerCase()){case OSF.StoreType.OMEX:a=0;break;case OSF.StoreType.SPCatalog:a=1;break;case OSF.StoreType.FileSystem:a=2;break;case OSF.StoreType.Registry:a=3;break;case OSF.StoreType.Exchange:a=4;break;case OSF.StoreType.SPApp:a=5;break;default:a=15}var b;switch(i){case OSF.OsfControlType.DocumentLevel:b=1;break;case OSF.OsfControlType.ContainerLevel:b=0;break;default:b=2}var c=7;if(d&&d.toLowerCase)switch(d.toLowerCase()){case Microsoft.Office.WebExtension.InitializationReason.Inserted.toLowerCase():c=0;break;case Microsoft.Office.WebExtension.InitializationReason.DocumentOpened.toLowerCase():c=1}var g=e.toLowerCase().indexOf("wa")===0?parseInt(e.substring(2),10):0,f=0;f=c<<8|b<<4|a;return [f,g]},isMyAppsReady:function(c){var b=false,a=this;if(!a._enableMyApps){c({isReady:b});return}if(a._omexGatedWSProxy&&a._omexGatedWSProxy.clientEndPoint){c({isReady:true,clientEndPoint:a._omexGatedWSProxy.clientEndPoint});return}var e=1,g=function(e){if(e.statusCode===OSF.ProxyCallStatusCode.Succeeded&&e.value){var f=parseInt(e.value);if(f==OSF.OmexAuthNStatus.Authenticated)a._omexAuthNStatus=OSF.OmexAuthNStatus.Authenticated;else if(f==OSF.OmexAuthNStatus.Anonymous||f==OSF.OmexAuthNStatus.Unknown){c({isReady:b});return}}else a._omexAuthNStatus=OSF.OmexAuthNStatus.CheckFailed;a._createOmexProxy(a._omexGatedWSProxy,d)},f=function(e){if(e&&(a._omexAuthNStatus==OSF.OmexAuthNStatus.NotAttempted||a._omexAuthNStatus==OSF.OmexAuthNStatus.Anonymous))if(a._omexAuthNStatus==OSF.OmexAuthNStatus.NotAttempted){var f={clientEndPoint:null};f.clientEndPoint=e;OSF.OsfManifestManager._invokeProxyMethodAsync(f,"OMEX_getAuthNStatus",g,f)}else a._omexAuthNStatus==OSF.OmexAuthNStatus.Anonymous&&c({isReady:b,clientEndPoint:e});else a._createOmexProxy(a._omexGatedWSProxy,d)},d=function(g){if(g)c({isReady:true,clientEndPoint:g});else if(e<OSF.Constants.AuthenticatedConnectMaxTries){e++;if(a._omexAuthNStatus==OSF.OmexAuthNStatus.CheckFailed)setTimeout(function(){a._createOmexProxy(a._omexGatedWSProxy,d)},500);else a._createOmexProxy(a._omexAnonymousWSProxy,f)}else c({isReady:b})};a._createOmexProxy(a._omexGatedWSProxy,d)},isMyOrgReady:function(b){var a=this;if(!a._enableMyOrg){b({isReady:false});return}if(a._spBaseUrl&&a._iframeProxies&&a._iframeProxies[a._spBaseUrl]&&a._iframeProxies[a._spBaseUrl].clientEndPoint){b({isReady:true,clientEndPoint:a._iframeProxies[a._spBaseUrl].clientEndPoint});return}var c=function(a){if(a)b({isReady:true,clientEndPoint:a});else b({isReady:false})};a._createSharePointIFrameProxy(a._spBaseUrl,c)},launchInsertDialog:function(b,f){var c=null,d="100%";b.childNodes.length!=0&&b.removeChild(b.childNodes.item(0));var a=this;a._insertDialogDiv=b;var e=document.createElement("div");e.style.width=d;e.style.height=d;e.style.backgroundImage="url("+a.getLocalizedImageFilePath("progress.gif")+")";e.style.backgroundRepeat="no-repeat";e.style.backgroundPosition="center";b.appendChild(e);var j={MyApp:"0",MyOrg:"1",Store:"{98143890-AC66-440E-A448-ED8771A02D52}"},g=function(b,d){if(!a._enableMyOrg){d({statusCode:OSF.InvokeResultCode.E_CATALOG_NO_APPS,value:c,context:b});return}OSF.OUtil.validateParamObject(b,{webUrl:{type:String,mayBeNull:false}},d);var e=function(a){if(a.isReady){b.clientEndPoint=a.clientEndPoint;var e={webUrl:b.webUrl};OSF.OsfManifestManager._invokeProxyMethodAsync(b,"OEM_getSPCatalogUrlAsync",d,e)}else d({statusCode:OSF.InvokeResultCode.E_GENERIC_ERROR,value:c,context:b})};a.isMyOrgReady(e)},h=function(o){var e="|",i='{ "myApp":',h='], "url":"',g=document.createElement("iframe");g.setAttribute("id","InsertDialog");g.setAttribute("src","about:blank");g.setAttribute("width",d);g.setAttribute("height",d);g.setAttribute("marginHeight","0");g.setAttribute("marginWidth","0");g.setAttribute("frameBorder","0");g.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin ms-allow-popups allow-popups");typeof Strings!="undefined"&&Strings&&Strings.OsfRuntime&&g.setAttribute("title",Strings.OsfRuntime.L_InsertionDialogTile_TXT);var m=c,j=c;if(a.isExternalMarketplaceAllowed()){var r=a._enableMyApps?OSF.InvokeResultCode.S_OK.toString():OSF.InvokeResultCode.S_HIDE_PROVIDER.toString();m='{ "provValues":[0,0,0,'+r+h+a._osfOmexBaseUrl+'", "client":"'+a._getClientNameForOmex()+'"}';j=i+m+" }"}var n=c;if(a._enableMyOrg){a._myOrgCatalogUrl=o.value;var q=o.statusCode;n='{ "provValues":[1,1,0,'+q+h+o.value+'"}';j=a.isExternalMarketplaceAllowed()?i+m+', "myOrg":'+n+" }":'{ "myOrg":'+n+" }"}a._internalConversationId&&a._serviceEndPointInternal.unregisterConversation(a._internalConversationId);var p=a.getClientId()+"_"+a.getDocUrl(),l=OSF.OUtil.getFrameNameAndConversationId(p,g);a._internalConversationId=OSF.OUtil.getFrameNameAndConversationId(p,g);var k;if(a._localizedResourcesUrl)k=OSF.OUtil.addXdmInfoAsHash(a._localizedResourcesUrl+"WefGallery.htm",l+e+window.location.href+e+a._appVersion+e+OSF.getAppVerCode(a._appName)+e+a.getLcid()+e+OSF.Constants.FileVersion+e+j+e+f);else k=OSF.OUtil.addXdmInfoAsHash(a._pageBaseUrl+a.getLcid()+"/WefGallery.htm",l+e+window.location.href+e+a._appVersion+e+OSF.getAppVerCode(a._appName)+e+a.getLcid()+e+OSF.Constants.FileVersion+e+j+e+f);a._serviceEndPointInternal.registerConversation(l,k);g.setAttribute("src",k);if(a._insertDialogDiv){b.childNodes.length!=0&&b.removeChild(b.childNodes.item(0));b.appendChild(g)}else{b.insertBefore(g,b.firstChild);a._insertDialogDiv=b}},i={webUrl:a._spBaseUrl};g(i,h)},activateAgavesBlockedBySandboxNotSupport:function(){for(var b in this._cachedOsfControls){var a=this._cachedOsfControls[b];a._status===OSF.OsfControlStatus.NotSandBoxSupported&&a.activate()}},setRequirementsChecker:function(a){this._requirementsChecker=a},getRequirementsChecker:function(){return this._requirementsChecker},appHasNotifications:function(a){return this._ErrorUXHelper.appHasNotifications(a)},_doesUrlHaveSupportedProtocol:function(b){var a=false;if(b){var c=decodeURIComponent(b),d=c.match(/^https?:\/\/.+$/ig);a=d!=null}return a},_loadLocaleString:function(c){var a=this;if(typeof Strings=="undefined"||!Strings||!Strings.OsfRuntime){a._localeStringLoadingPendingCallbacks.push(c);var b=a._localeStringLoadingPendingCallbacks;if(b.length===1){var e=function(){for(var c=b.length,a=0;a<c;a++){var d=b.shift();d()}};a._loadStringScript(e)}}else{for(var f=a._localeStringLoadingPendingCallbacks.length,d=0;d<f;d++){var g=a._localeStringLoadingPendingCallbacks.shift();g()}c()}},_loadStringScript:function(c){var a=this.getLocalizedScriptsUrl();a+="osfruntime_strings.js";var b=function(){if(typeof Strings=="undefined"||!Strings||!Strings.OsfRuntime){this._localeStringLoadingPendingCallbacks.length=0;throw OSF.OUtil.formatString("The locale, {0}, provided by the host app is not supported.",this.getLcid())}else c()};OSF.OUtil.loadScript(a,Function.createDelegate(this,b))},_getServiceEndPoint:function(){return this._serviceEndPoint},_getOmexEndPointPageUrl:function(b,a){return OSF.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",this._omexEndPointBaseUrl,a,b)},_getManifestAndTargetByConversationId:function(b){for(var c in this._cachedOsfControls){var a=this._cachedOsfControls[c];if(b===a._getConversationId())return {manifest:OSF.OsfManifestManager.getCachedManifest(a.getMarketplaceID(),a.getMarketplaceVersion()),target:a.getOsfControlType()}}return null},_createOmexProxy:function(a,f){var e="load",b=null,g=b,h=function(){if(a.clientEndPoint)a.clientEndPoint.invoke("OMEX_isProxyReady",j,{__timeout__:500});else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error, iframe loaded again after failing OMEX_isProxyReady.",b,b,6612420);OSF.OUtil.set_entropy((new Date).getTime())};if(a.refresh){a.isReady=false;a.refresh=false;if(a.clientEndPoint){Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(a.clientEndPoint._conversationId);a.clientEndPoint=b}if(a.iframe){OSF.OUtil.removeEventListener(a.iframe,e,h);a.iframe.parentNode.removeChild(a.iframe)}}if(a.isReady)f(a.clientEndPoint);else if(!a.clientEndPoint){if(!this._doesUrlHaveSupportedProtocol(a.proxyUrl)){f(b);return}var d=OSF.OUtil.generateConversationId(),c=document.createElement("iframe");c.setAttribute("id",a.proxyName);c.setAttribute("name",a.proxyName);var i=a.proxyUrl+"?"+d;i=OSF.OUtil.addXdmInfoAsHash(i,d+"|"+a.proxyName+"|"+window.location.href);c.setAttribute("src",i);c.setAttribute("scrolling","auto");c.setAttribute("border","0");c.setAttribute("width","0");c.setAttribute("height","0");c.setAttribute("style","position: absolute; left: -100px; top:0px;");var j=function(k,l){var f=a.pendingCallbacks.length;if(f==0)return;if(k===0&&l.status){a.isReady=true;a.iframe=c;g=a.clientEndPoint}else{a.clientEndPoint=b;if(Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(d)){Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(d);OSF.OUtil.removeEventListener(c,e,h);c.parentNode.removeChild(c)}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error occured with marketplace proxy.",b,b,6062165);g=b}for(var i=0;i<f;i++){var j=a.pendingCallbacks.shift();j(g)}};document.body.appendChild(c);OSF.OUtil.addEventListener(c,e,h);a.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(d,c.contentWindow,a.proxyUrl);a.pendingCallbacks.push(f)}else a.pendingCallbacks.push(f)},_createSharePointIFrameProxy:function(b,f){var d=null,c=this;if(!c._doesUrlHaveSupportedProtocol(b)){f(d);return}var l=b.length;if(b.charAt(l-1)==="/")b=b.substr(0,l-1);var g=c._iframeProxies[b];if(!g){var e=OSF.OUtil.generateConversationId(),a=document.createElement("iframe");c._iframeProxyCount=c._iframeProxyCount+1;var h=c._iframeNamePrefix+c._iframeProxyCount;a.setAttribute("id",h);a.setAttribute("name",h);var i=b+"/_layouts/15/OfficeExtensionManager.aspx?"+e;i=OSF.OUtil.addXdmInfoAsHash(i,e+"|"+h+"|"+window.location.href);a.setAttribute("src",i);a.setAttribute("scrolling","auto");a.setAttribute("border","0");a.setAttribute("width","0");a.setAttribute("height","0");a.setAttribute("style","position: absolute; left: -100px; top:0px;");var j=c,m=function(l,m){var f,c=j._iframeProxies[b];if(l===0&&m.status){c.isReady=true;f=c.clientEndPoint}else{delete j._iframeProxies[b];if(Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(e)){Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(e);OSF.OUtil.removeEventListener(a,"load",k);a.parentNode.removeChild(a)}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error occured with SharePoint proxy.",d,d,6062166);f=d}for(var h=c.pendingCallbacks.length,g=0;g<h;g++){var i=c.pendingCallbacks.shift();i(f)}},k=function(){var a=j._iframeProxies[b];a.clientEndPoint.invoke("OEM_isProxyReady",m,{__timeout__:2e3})};document.body.appendChild(a);OSF.OUtil.addEventListener(a,"load",k);var n=Microsoft.Office.Common.XdmCommunicationManager.connect(e,a.contentWindow,b);c._iframeProxies[b]={clientEndPoint:n,isReady:false,pendingCallbacks:[f]}}else if(g.isReady)f(g.clientEndPoint);else g.pendingCallbacks.push(f)},_getClientVersionForOmex:function(){if(!this._appVersion)return undefined;var b=this._appVersion.split("."),c=parseInt(b[0],10),d=parseInt(b[1],10)||0;if(c<=15&&d<=0)return undefined;var a=OSF.Constants.FileVersion.split(".");return c+"."+d+"."+a[2]+"."+a[3]},_getClientNameForOmex:function(){return OSF.OmexClientNames[this._appName]},_getAppVersionForOmex:function(){return OSF.OmexAppVersions[this._appName]},_setCachedFlag:function(b){var a=OSF.OUtil.getLocalStorage();a&&a.setItem(b,"true")},_getCachedFlag:function(c){var a=OSF.OUtil.getLocalStorage();if(a){var b=a.getItem(c);return b?true:false}},_deleteCachedFlag:function(b){var a=OSF.OUtil.getLocalStorage();a&&a.removeItem(b)}};OSF.OsfManifestManager=function(){var i="undefined",e="marketplaceVersion",d="marketplaceID",h="cacheExpired",b=null,c=true,a=false,f={},j="en-us",k={};function g(b,a){return b+"_"+a}return {getManifestAsync:function(d,h){OSF.OUtil.validateParamObject(d,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a}},h);var e=d.referenceInUse,k=g(e.id,e.version),i=f[k];d.manifestCached=a;if(i){d.manifestCached=c;h({statusCode:OSF.ProxyCallStatusCode.Succeeded,value:i,context:d})}else if(d.clientEndPoint&&d.manifestUrl){Telemetry.AppLoadTimeHelper.ManifestRequestStart(d.osfControl._telemetryContext);var j=function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){var d;try{d=a.context.osfControl;var f;if(typeof a.value==="string"){a.context.manifestCached=c;f=a.value}else{a.context.manifestCached=a.value.cached;f=a.value.manifest}Telemetry.AppLoadTimeHelper.SetManifestDataCachedFlag(d._telemetryContext,a.value.cached);a.value=new OSF.Manifest.Manifest(f,d._contextActivationMgr.getAppUILocale());OSF.OsfManifestManager.cacheManifest(e.id,e.version,a.value)}catch(g){a.value=b;var i;if(d)i=d._appCorrelationId;Sys.Debug.trace("Invalid manifest in getManifestAsync: "+g);Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid manifest in getManifestAsync.",g,i,6062167)}}h(a)},l={manifestUrl:d.manifestUrl,id:e.id,version:e.version,clearCache:d.clearCache||a};this._invokeProxyMethodAsync(d,"OEM_getManifestAsync",j,l)}else h({statusCode:OSF.ProxyCallStatusCode.Failed,value:b,context:d})},getAppInstanceInfoByIdAsync:function(b,c){OSF.OUtil.validateParamObject(b,{webUrl:{type:String,mayBeNull:a},appInstanceId:{type:String,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a}},c);var d={webUrl:b.webUrl,appInstanceId:b.appInstanceId,clearCache:b.clearCache||a};this._invokeProxyMethodAsync(b,"OEM_getSPAppInstanceInfoByIdAsync",c,d)},getSPTokenByProductIdAsync:function(c,d){OSF.OUtil.validateParamObject(c,{appWebUrl:{type:String,mayBeNull:a},productId:{type:String,mayBeNull:a}},d);var f=this,e=function(e){if(e){var g={webUrl:c.appWebUrl,productId:c.productId,clearCache:c.clearCache||a,clientEndPoint:e};f._invokeProxyMethodAsync(c,"OEM_getSPTokenByProductIdAsync",d,g)}else d({statusCode:OSF.ProxyCallStatusCode.ProxyNotReady,value:b,context:c})};c.osfControl._contextActivationMgr._createSharePointIFrameProxy(c.appWebUrl,e)},getSPAppEntitlementsAsync:function(e,g){var d="/";OSF.OUtil.validateParamObject(e,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},baseUrl:{type:String,mayBeNull:a},pageUrl:{type:String,mayBeNull:a},webUrl:{type:String,mayBeNull:c}},g);if(!e.webUrl){var h=document.createElement("a");h.href=e.pageUrl;var o=h.pathname,m=o.split(d),r=m.length-1,f=h.href.substring(0,h.href.length-o.length);if(f&&f.charAt(f.length-1)!==d)f+=d;for(var j=[f],k=0;k<r;k++)if(m[k]){f=f+m[k]+d;j.push(f)}h=b;var p=this,l=e.osfControl._contextActivationMgr,i=j.pop(),q=function(b){if(b.statusCode===OSF.ProxyCallStatusCode.Succeeded){var a=b.value;if(a&&a.charAt(a.length-1)!==d)a+=d;l._webUrl=a;b.context.webUrl=a;b.context.appWebUrl=a;p.getCorporateCatalogEntitlementsAsync(b.context,g)}else g(b)},n=function(c){if(c){e.clientEndPoint=c;var d={pageUrl:e.pageUrl,baseUrl:i,clearCache:e.clearCache||a};p._invokeProxyMethodAsync(e,"OEM_getSPAppWebUrlFromPageUrlAsync",q,d)}else if(j.length>0){i=j.pop();l._createSharePointIFrameProxy(i,n)}else g({statusCode:OSF.ProxyCallStatusCode.Failed,value:b,context:e})};l._createSharePointIFrameProxy(i,n)}else this.getCorporateCatalogEntitlementsAsync(e,g)},getCorporateCatalogEntitlementsAsync:function(d,e){OSF.OUtil.validateParamObject(d,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},webUrl:{type:String,mayBeNull:a}},e);Telemetry.AppLoadTimeHelper.AuthenticationStart(d.osfControl._telemetryContext);var h=this,g=0,f=function(i){if(i){Telemetry.AppLoadTimeHelper.AuthenticationEnd(d.osfControl._telemetryContext);d.clientEndPoint=i;var j={webUrl:d.webUrl,applicationName:OSF.HostCapability[d.hostType],officeExtentionTarget:d.noTargetType||d.osfControl.getOsfControlType()===OSF.OsfControlTarget.TaskPane?b:d.osfControl.getOsfControlType(),clearCache:d.clearCache||a,supportedManifestVersions:{"1.0":c,"1.1":c}};h._invokeProxyMethodAsync(d,"OEM_getEntitlementSummaryAsync",e,j)}else if(g<OSF.Constants.AuthenticatedConnectMaxTries){g++;setTimeout(function(){d.osfControl._contextActivationMgr._createSharePointIFrameProxy(d.webUrl,f)},500)}else e({statusCode:OSF.ProxyCallStatusCode.ProxyNotReady,value:b,context:d})};d.osfControl._contextActivationMgr._createSharePointIFrameProxy(d.webUrl,f)},_invokeProxyMethodAsync:function(c,g,p,a){var o=a.clientEndPoint?a.clientEndPoint._targetUrl:c.clientEndPoint._targetUrl,j=[o,g],e;for(var m in a){e=typeof a[m];(e==="string"||e==="number"||e==="boolean")&&j.push(a[m])}var f=j.join("."),d=k,i={onCompleted:p,context:c,methodName:g},h=d[f];if(!h){d[f]=[i];var n=function(m,c){var j=b,i=OSF.ProxyCallStatusCode.Failed;if(m===0&&c.status){j=c.result;i=OSF.ProxyCallStatusCode.Succeeded}var h=d[f];delete d[f];for(var l=h.length,k=0;k<l;k++){var a=h.shift(),e;try{if(a.context&&a.context.osfControl)e=a.context.osfControl._appCorrelationId;c&&c.failureInfo&&Telemetry.RuntimeTelemetryHelper.LogProxyFailure(e,a.methodName,c.failureInfo);a.onCompleted({statusCode:i,value:j,context:a.context})}catch(g){Sys.Debug.trace("_invokeProxyMethodAsync failed: "+g);Telemetry.RuntimeTelemetryHelper.LogExceptionTag("_invokeProxyMethodAsync failed.",g,e,6062168)}}},l=c.clientEndPoint;if(a.clientEndPoint){l=a.clientEndPoint;delete a.clientEndPoint}if(c.referenceInUse&&c.referenceInUse.storeType===OSF.StoreType.OMEX)a.officeVersion=OSF.Constants.ThreePartsFileVersion;l.invoke(g,n,a)}else h.push(i)},getOmexEntitlementsAsync:function(b,c){OSF.OUtil.validateParamObject(b,{referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a},anonymous:{type:Boolean,mayBeNull:a}},c);var d={applicationName:b.hostType,appVersion:b.appVersion,build:OSF.Constants.FileVersion,clearEntitlement:b.clearCache||b.clearEntitlement||a,clientName:b.clientName,clientVersion:b.clientVersion,correlationId:b.correlationId};this._invokeProxyMethodAsync(b,"OMEX_getEntitlementSummaryAsync",c,d)},getOmexAppDetailsAsync:function(b,d){OSF.OUtil.validateParamObject(b,{assetId:{type:String,mayBeNull:a},contentMarket:{type:String,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:c},anonymous:{type:Boolean,mayBeNull:a},clientName:{type:String,mayBeNull:a},clientVersion:{type:String,mayBeNull:a}},d);var e={assetid:"",assetID:b.assetId,contentMarket:b.contentMarket,build:OSF.Constants.FileVersion,clearCache:b.clearCache||b.clearEntitlement||a,clientName:b.clientName,clientVersion:b.clientVersion,correlationId:b.correlationId};b.manifestManager=this;_omexDataProvider.GetAppDetails(b,e,d)},getOmexKilledAppsAsync:function(b,c){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a},anonymous:{type:Boolean,mayBeNull:a}},c);var d={clearKilledApps:b.clearCache||b.clearKilledApps||a,clientName:b.clientName,clientVersion:b.clientVersion,correlationId:b.correlationId};b.manifestManager=this;_omexDataProvider.GetKilledApps(b,d,c)},getOmexAppStateAsync:function(b,d){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a},anonymous:{type:Boolean,mayBeNull:c}},d);var e=b.referenceInUse,f={assetID:e.id,contentMarket:e.storeLocator,clearAppState:b.clearCache||b.clearAppState||a,clientName:b.clientName,errors:{},clientVersion:b.clientVersion,correlationId:b.correlationId};b.manifestManager=this;_omexDataProvider.GetAppState(b,f,d);b.osfControl._telemetryContext&&Telemetry.AppLoadTimeHelper.SetAppStateDataInvalidFlag(b.osfControl._telemetryContext,f.errors[h])},getOmexManifestAndETokenAsync:function(b,e){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a},anonymous:{type:Boolean,mayBeNull:a}},e);var d=b.referenceInUse,c={applicationName:b.hostType,assetID:d.id,build:OSF.Constants.FileVersion,clientName:b.clientName,clientVersion:b.clientVersion,clientAppInfoReturnType:b.clientAppInfoReturnType,errors:{},correlationId:b.correlationId};if(b.anonymous){c.contentMarket=d.storeLocator;c.clearManifest=b.clearCache||b.clearManifest||a}else{c.assetContentMarket=b.osfControl._omexEntitlement.contentMarket;c.userContentMarket=d.storeLocator;c.clearToken=b.clearCache||b.clearToken||a;c.clearManifest=b.clearCache||b.clearManifest||a;if(b.acceptedUpgrade)c.expectedVersion=b.expectedVersion;else if(b.osfControl._omexEntitlement.hasEntitlement)c.expectedVersion=b.osfControl._omexEntitlement.version}b.manifestManager=this;_omexDataProvider.GetManifestAndEToken(b,c,e);b.osfControl._telemetryContext&&Telemetry.AppLoadTimeHelper.SetManifestDataInvalidFlag(b.osfControl._telemetryContext,c.errors[h])},removeOmexAppAsync:function(b,c){OSF.OUtil.validateParamObject(b,{assetId:{type:String,mayBeNull:a},clientName:{type:String,mayBeNull:a},clientVersion:{type:String,mayBeNull:a}},c);var d={assetID:b.assetId,clientName:b.clientName,clientVersion:b.clientVersion,correlationId:b.correlationId};this._invokeProxyMethodAsync(b,"OMEX_removeAppAsync",c,d)},removeOmexCacheAsync:function(b,e){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a}},e);var d=b.referenceInUse,c={applicationName:b.hostType,assetID:d.id,officeExtentionTarget:b.osfControl.getOsfControlType(),clearEntitlement:b.clearEntitlement||a,clearToken:b.clearToken||a,clearAppState:b.clearAppState||a,clearManifest:b.clearManifest||a,appVersion:b.appVersion};if(b.anonymous)c.contentMarket=d.storeLocator;else{c.assetContentMarket=b.osfControl._omexEntitlement.contentMarket;c.userContentMarket=d.storeLocator}this._invokeProxyMethodAsync(b,"OMEX_removeCacheAsync",e,c)},purgeManifest:function(j,h){var c=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(c)throw c;var b=g(j,h);if(typeof f[b]!=i)delete f[b]},cacheManifest:function(i,h,b){var c=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a},{name:"manifest",type:Object,mayBeNull:a}]);if(c)throw c;var k=g(i,h);b._UILocale=j;f[k]=b},hasManifest:function(j,h){var b=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(b)throw b;var k=g(j,h);if(typeof f[k]!=i)return c;return a},getCachedManifest:function(h,c){var b=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(b)throw b;var i=g(h,c);return f[i]},_setUILocale:function(a){j=a}}}();OSF.InfoType={Error:0,Warning:1,Information:2,SecurityInfo:3};OSF._ErrorUXHelper=function(H){var s="progress_",i=true,f=false,h="100%",r="center",q="no-repeat",p="alpha(opacity=100)",o="white",n="url(",g="onclick",k="tabindex",j="type",c="id",m="moe-background",a="class",e="div",y="notificationbackground_",x="moe-infobar-body_",u="agavedefaulticon96x96.png",l="moe_status_icons.png",E="progress.gif",t="img",d=H;OSF.OUtil.loadCSS(d.getLocalizedCSSFilePath("moeerrorux.css"));var M=document.createElement(t);M.src=d.getLocalizedImageFilePath(E);var K=document.createElement(t);K.src=d.getLocalizedImageFilePath(l);var J=document.createElement(t);J.src=d.getLocalizedImageFilePath(u);var b={},B=0,z=function(a){var d=a.childNodes.length,c=0,b;while(c<d){b=a.childNodes.item(c);if(b.tagName.toLowerCase()==="iframe")c++;else{a.removeChild(b);d--}}},C=function(b){var a=document.getElementById(b);a&&a.parentNode.removeChild(a)},N=function(a){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage1Start);C("icon_"+a);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage1End)},D=function(a,e){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage2Start);var c;if(e)c=x+a;else c=y+a;var d=b[a]&&b[a].length>0;if(d&&b[a][0].highPriority)B--;C(c);d&&b[a].shift();OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage2End)},G=function(b){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage1Start);z(b.div);var f=document.createElement(e);f.setAttribute(a,m);f.setAttribute(c,"icon_"+b.id);var i=document.createElement("input");i.setAttribute(c,"iconImg_"+b.id);i.setAttribute(j,"image");i.setAttribute(k,"0");i.src=d.getLocalizedImageFilePath(l);var x=function(a){a.sqmDWords[1]|=2;F(a);v(a.id)};i.setAttribute(g,"getIntoStage2(params)");OSF.OUtil.attachClickHandler(i,function(){x(b)});f.appendChild(i);if(b.displayDeactive){f.style.backgroundImage=n+d.getLocalizedImageFilePath(u)+")";f.style.backgroundColor=o;f.style.opacity="1";f.style.filter=p;f.style.backgroundRepeat=q;f.style.backgroundPosition=r;f.style.height=h}var s,w,t;if(b.infoType===OSF.InfoType.Error){s="moe-status-error-icon";w="iconImg_error_"+b.id;t=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT}else if(b.infoType===OSF.InfoType.Warning){s="moe-status-warning-icon";w="iconImg_warning_"+b.id;t=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT}else if(b.infoType===OSF.InfoType.Information){s="moe-status-info-icon";w="iconImg_info_"+b.id;t=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT}else{s="moe-status-secinfo-icon";w="iconImg_secinfo_"+b.id;t=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT}if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&Sys.Browser.version===9)s+="_ie";i.setAttribute(a,s);i.setAttribute(c,w);i.setAttribute("alt",t);if(b.div.childNodes.length!=0)b.div.insertBefore(f,b.div.childNodes[0]);else b.div.appendChild(f);A(b.id);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage1End)},F=function(s){var O="moe-infobar-button",H="button",N="presentation";OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2Start);z(s.div);var bb=s.description;if(s.title.length>100)s.title=s.title.substring(0,99);if(s.description.length>255)s.description=s.description.substring(0,254);var X=x+s.id,I=document.getElementById(X);if(I==undefined){I=document.createElement(e);I.setAttribute(a,"moe-infobar-body");I.setAttribute(c,X)}var S=document.createElement(e);S.innerHTML=bb;I.setAttribute("title",S.textContent);S=null;var L=document.createElement("table");L.setAttribute(a,"moe-infobar-infotable");L.setAttribute("role",N);for(var Y,U=0;U<3;U++){Y=L.insertRow(U);Y.setAttribute("role",N)}var B=L.rows;B[0].insertCell(0);B[0].insertCell(1);B[0].insertCell(2);B[0].cells[1].setAttribute("rowSpan","2");B[1].insertCell(0);B[1].insertCell(1);B[2].insertCell(0);B[2].insertCell(1);B[2].insertCell(2);B[0].cells[0].setAttribute(a,"moe-infobar-top-left-cell");B[0].cells[1].setAttribute(a,"moe-infobar-message-cell");B[0].cells[2].setAttribute(a,"moe-infobar-top-right-cell");B[2].cells[1].setAttribute(a,"moe-infobar-button-cell");var P=document.createElement(t);P.src=d.getLocalizedImageFilePath(l);var K,M;if(s.infoType===OSF.InfoType.Error){K="moe-infobar-error";M=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT}else if(s.infoType===OSF.InfoType.Warning){K="moe-infobar-warning";M=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT}else if(s.infoType===OSF.InfoType.Information){K="moe-infobar-info";M=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT}else{K="moe-infobar-secinfo";M=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT}P.setAttribute(a,K);P.setAttribute("alt",M);B[0].cells[0].appendChild(P);var Q=document.createElement(e);Q.setAttribute(a,"moe-infobar-message-div");var T=document.createElement("span");T.setAttribute(a,"moe-infobar-title");T.innerHTML=s.title;var V="moe-infobar-message_"+s.id,J=document.getElementById(V);if(J==undefined){J=document.createElement("span");J.setAttribute(a,"moe-infobar-message");J.setAttribute(c,V)}J.innerHTML=s.description;Q.appendChild(T);Q.appendChild(J);B[0].cells[1].appendChild(Q);var R=function(a){var b=d.getOsfControl(a.id);Telemetry.AppNotificationHelper.LogNotification(b._appCorrelationId,a.sqmDWords[0],a.sqmDWords[1])},W=function(){s.sqmDWords[1]|=8;R(s);!s.reDisplay&&D(s.id,s.displayDeactive);if(s.reDisplay)w(s);else if(b[s.id].length>0){var a=b[s.id][0];w(a)}s.dismissCallback&&s.dismissCallback();v(s.id)},F=document.createElement("input");F.setAttribute(j,"image");F.setAttribute("src",d.getLocalizedImageFilePath(l));F.setAttribute(a,"moe-infobar-dismiss");F.setAttribute(c,"moe-infobar-dismiss_"+s.id);F.setAttribute(k,"0");F.setAttribute("alt",Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT);F.setAttribute(g,"handleDismiss();");OSF.OUtil.attachClickHandler(F,W);B[0].cells[2].appendChild(F);s.detailView=f;var E=document.createElement(H);E.setAttribute(a,O);E.innerHTML=s.buttonTxt;E.setAttribute(c,"moe-infobar-button_"+s.id);E.setAttribute(k,"0");E.setAttribute(j,H);if(s.buttonCallback){var ab=function(){s.sqmDWords[1]|=4;R(s);D(s.id,f);if(b[s.id].length>0){var c=b[s.id][0];w(c)}if(s.retryAll===i){var a=d.getOsfControl(s.id);a._retryActivate=null;d.retryAll(a._marketplaceID)}s.buttonCallback();v(s.id)};E.setAttribute(g,"handleButtonClick()");OSF.OUtil.attachClickHandler(E,ab)}else{E.setAttribute(g,"handleDismiss()");OSF.OUtil.attachClickHandler(E,W)}B[2].cells[1].appendChild(E);if(s.url){var Z=function(){s.sqmDWords[1]|=4;R(s);s.sqmDWords[1]=1;window.open(s.url)},G=document.createElement(H);G.setAttribute(a,O);G.innerHTML=s.urlButtonTxt?s.urlButtonTxt:Strings.OsfRuntime.L_MoreInfoButton_TXT;G.setAttribute(c,"moe-infobar-button2_"+s.id);G.setAttribute(g,"moreInfoButtonClick()");OSF.OUtil.attachClickHandler(G,Z);G.setAttribute(k,"0");G.setAttribute(j,H);B[2].cells[1].appendChild(G)}I.appendChild(L);var C=document.createElement(e);C.setAttribute(a,m);C.setAttribute(c,y+s.id);if(s.displayDeactive){C.style.backgroundImage=n+d.getLocalizedImageFilePath(u)+")";C.style.backgroundColor=o;C.style.opacity="1";C.style.filter=p;C.style.backgroundRepeat=q;C.style.backgroundPosition=r;C.style.height=h}C.appendChild(I);if(s.div.childNodes.length!=0)s.div.insertBefore(C,s.div.childNodes[0]);else s.div.appendChild(C);A(s.id);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2End)},v=function(b){var a=d.getOsfControl(b);if(a)a._controlFocus=i},A=function(c){var g=d.getOsfControl(c);if(g)if(g._controlFocus)if(b[c]&&b[c].length>0){var f=b[c][0];if(f&&f.div){var a=f.div.querySelectorAll("input,a,button");if(a&&a.length>0){var e;if(a.length===1)e=a[0];else e=a[1];if(e instanceof HTMLElement){e.focus();d._notifyHost&&d._notifyHost(c,OSF.AgaveHostAction.SelectWithError)}}}}},w=function(a){if(a.detailView==undefined||a.detailView===f){a.sqmDWords[1]=0;G(a)}else{a.sqmDWords[1]=1;F(a)}},L=function(a){if(b[a]){if(b[a].length>0){var c=b[a][0].div;z(c)}delete b[a]}},I=function(c){var a=document.createElement(e),b=document.createTextNode(c);a.appendChild(b);return a.innerHTML};return {showProgress:function(k,i){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderLoadingAnimationStart);var j=document.getElementById(s+i);if(!j){b[i]=[];var f=document.createElement(e);f.setAttribute(a,m);f.setAttribute(c,s+i);f.style.backgroundColor=o;f.style.opacity="1";f.style.filter=p;f.style.height=h;var g=document.createElement(e);g.style.width=h;g.style.height=h;g.style.backgroundImage=n+d.getLocalizedImageFilePath(E)+")";g.style.backgroundRepeat=q;g.style.backgroundPosition=r;f.appendChild(g);k.appendChild(f)}OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderLoadingAnimationEnd)},showNotification:function(a){a.sqmDWords=[a.errorCode,0];delete a.errorCode;if(a.highPriority==undefined)a.highPriority=a.infoType===OSF.InfoType.Error?i:f;if(a.reDisplay==undefined)a.reDisplay=a.infoType===OSF.InfoType.Error?i:f;var c=b[a.id];if(c===undefined){c=[];b[a.id]=c}if(a.highPriority===f)c.push(a);else{c.splice(B,0,a);B++}(b[a.id].length===1||a.highPriority)&&w(c[0])},showICon:function(a){G(a)},removeDOMElement:function(a){C(a)},removeProgressDiv:function(a,c){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveLoadingAnimationStart);var b=a.ownerDocument.getElementById(s+c);b&&z(a);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveLoadingAnimationEnd)},removeIConDiv:function(a){N(a)},removeInfoBarDiv:function(b,a){D(b,a)},dismissMessages:function(a){L(a)},getHTMLEncodedString:function(a){return I(a)},purgeOsfControlNotification:function(c){var a=b[c],e=d.getOsfControl(c);a&&a.length>0&&e&&Telemetry.AppNotificationHelper.LogNotification(c,a[0].sqmDWords[0],a[0].sqmDWords[1])},focusOnNotificationUx:function(a){v(a);A(a)},appHasNotifications:function(a){return b[a]&&b[a].length>0}}};
window.scriptsLoaded['osfruntime.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['osfruntime.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
